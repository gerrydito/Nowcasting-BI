<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Artificial Intelligence untuk Nowcasting</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="AI untuk Nowcasting_files/libs/clipboard/clipboard.min.js"></script>
<script src="AI untuk Nowcasting_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="AI untuk Nowcasting_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="AI untuk Nowcasting_files/libs/quarto-html/popper.min.js"></script>
<script src="AI untuk Nowcasting_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="AI untuk Nowcasting_files/libs/quarto-html/anchor.min.js"></script>
<link href="AI untuk Nowcasting_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="AI untuk Nowcasting_files/libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="AI untuk Nowcasting_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="AI untuk Nowcasting_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="AI untuk Nowcasting_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="AI untuk Nowcasting_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="AI untuk Nowcasting_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="AI untuk Nowcasting_files/libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="AI untuk Nowcasting_files/libs/typedarray-0.1/typedarray.min.js"></script>

<script src="AI untuk Nowcasting_files/libs/jquery-3.5.1/jquery.min.js"></script>

<link href="AI untuk Nowcasting_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="AI untuk Nowcasting_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="AI untuk Nowcasting_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="AI untuk Nowcasting_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>



</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#package" id="toc-package" class="nav-link active" data-scroll-target="#package">Package</a></li>
  <li><a href="#grafik-time-series" id="toc-grafik-time-series" class="nav-link" data-scroll-target="#grafik-time-series">Grafik Time Series</a></li>
  <li><a href="#grafik-time-series-differencing" id="toc-grafik-time-series-differencing" class="nav-link" data-scroll-target="#grafik-time-series-differencing">Grafik Time Series Differencing</a></li>
  <li><a href="#multi-input-multi-output-mimo" id="toc-multi-input-multi-output-mimo" class="nav-link" data-scroll-target="#multi-input-multi-output-mimo">Multi Input Multi Output (MIMO)</a>
  <ul class="collapse">
  <li><a href="#fungsi-pembantu" id="toc-fungsi-pembantu" class="nav-link" data-scroll-target="#fungsi-pembantu">Fungsi pembantu</a></li>
  <li><a href="#struktur-data-mimo" id="toc-struktur-data-mimo" class="nav-link" data-scroll-target="#struktur-data-mimo">Struktur Data MIMO</a></li>
  </ul></li>
  <li><a href="#lstm" id="toc-lstm" class="nav-link" data-scroll-target="#lstm">LSTM</a>
  <ul class="collapse">
  <li><a href="#fungsi-pembantu-lstm" id="toc-fungsi-pembantu-lstm" class="nav-link" data-scroll-target="#fungsi-pembantu-lstm">Fungsi pembantu LSTM</a></li>
  <li><a href="#satu-variabel" id="toc-satu-variabel" class="nav-link" data-scroll-target="#satu-variabel">Satu Variabel</a></li>
  <li><a href="#multi-variabel" id="toc-multi-variabel" class="nav-link" data-scroll-target="#multi-variabel">Multi Variabel</a></li>
  </ul></li>
  <li><a href="#rnn" id="toc-rnn" class="nav-link" data-scroll-target="#rnn">RNN</a>
  <ul class="collapse">
  <li><a href="#fungsi-pembantu-1" id="toc-fungsi-pembantu-1" class="nav-link" data-scroll-target="#fungsi-pembantu-1">Fungsi Pembantu</a></li>
  <li><a href="#satu-variabel-1" id="toc-satu-variabel-1" class="nav-link" data-scroll-target="#satu-variabel-1">Satu Variabel</a></li>
  <li><a href="#multi-variabel-1" id="toc-multi-variabel-1" class="nav-link" data-scroll-target="#multi-variabel-1">Multi Variabel</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Artificial Intelligence untuk Nowcasting</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="package" class="level2">
<h2 class="anchored" data-anchor-id="package">Package</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|output: false</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timetk)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(torch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"Data_PDRB_siap.xlsx"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 108
Columns: 9
$ date              &lt;chr&gt; "2015-01-01", "2015-02-01", "2015-03-01", "2015-04-0…
$ ADHK              &lt;dbl&gt; NA, NA, 20908.25, NA, NA, 21772.33, NA, NA, 24374.33…
$ prod_tbg          &lt;dbl&gt; 55258.07, 60589.93, 65392.61, 65309.37, 60522.22, 67…
$ kredit_konstruksi &lt;dbl&gt; 415006364126, 425296793497, 427231593289, 4268685445…
$ ekspor            &lt;dbl&gt; 63006048, 93951704, 95186751, 2977944, 287826539, 85…
$ pmi_jepang        &lt;dbl&gt; 52.2, 51.6, 50.3, 49.9, 50.9, 50.1, 51.2, 51.7, 51.0…
$ ihk               &lt;dbl&gt; 98.85237, 98.85837, 98.85527, 98.85477, 98.85197, 98…
$ soi               &lt;dbl&gt; -6.8, -7.8, 0.6, -11.3, -3.1, -13.7, -12.0, -14.7, -…
$ ikk               &lt;dbl&gt; 128.80, 123.50, 118.90, 114.30, 118.20, 121.10, 124.…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">skim_without_charts</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">df</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">108</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">date</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ADHK</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">2.381665e+04</td>
<td style="text-align: right;">1.471340e+03</td>
<td style="text-align: right;">2.090825e+04</td>
<td style="text-align: right;">2.286731e+04</td>
<td style="text-align: right;">2.353550e+04</td>
<td style="text-align: right;">2.461094e+04</td>
<td style="text-align: right;">2.686253e+04</td>
</tr>
<tr class="even">
<td style="text-align: left;">prod_tbg</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5.130405e+04</td>
<td style="text-align: right;">2.225696e+04</td>
<td style="text-align: right;">1.034700e+04</td>
<td style="text-align: right;">3.086954e+04</td>
<td style="text-align: right;">4.929497e+04</td>
<td style="text-align: right;">6.864869e+04</td>
<td style="text-align: right;">1.002820e+05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">kredit_konstruksi</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.032414e+12</td>
<td style="text-align: right;">3.340913e+11</td>
<td style="text-align: right;">4.150064e+11</td>
<td style="text-align: right;">7.217620e+11</td>
<td style="text-align: right;">1.146078e+12</td>
<td style="text-align: right;">1.276832e+12</td>
<td style="text-align: right;">1.572429e+12</td>
</tr>
<tr class="even">
<td style="text-align: left;">ekspor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.093068e+08</td>
<td style="text-align: right;">9.876552e+07</td>
<td style="text-align: right;">2.098050e+05</td>
<td style="text-align: right;">3.590831e+07</td>
<td style="text-align: right;">7.953155e+07</td>
<td style="text-align: right;">1.575475e+08</td>
<td style="text-align: right;">4.055064e+08</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pmi_jepang</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5.069000e+01</td>
<td style="text-align: right;">2.780000e+00</td>
<td style="text-align: right;">3.840000e+01</td>
<td style="text-align: right;">4.907000e+01</td>
<td style="text-align: right;">5.110000e+01</td>
<td style="text-align: right;">5.270000e+01</td>
<td style="text-align: right;">5.540000e+01</td>
</tr>
<tr class="even">
<td style="text-align: left;">ihk</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.035400e+02</td>
<td style="text-align: right;">5.290000e+00</td>
<td style="text-align: right;">9.876000e+01</td>
<td style="text-align: right;">9.883000e+01</td>
<td style="text-align: right;">1.026100e+02</td>
<td style="text-align: right;">1.052700e+02</td>
<td style="text-align: right;">1.159700e+02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">soi</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">1.090000e+00</td>
<td style="text-align: right;">1.002000e+01</td>
<td style="text-align: right;">-2.200000e+01</td>
<td style="text-align: right;">-5.750000e+00</td>
<td style="text-align: right;">1.450000e+00</td>
<td style="text-align: right;">8.170000e+00</td>
<td style="text-align: right;">2.260000e+01</td>
</tr>
<tr class="even">
<td style="text-align: left;">ikk</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.123600e+02</td>
<td style="text-align: right;">1.353000e+01</td>
<td style="text-align: right;">7.558000e+01</td>
<td style="text-align: right;">1.068600e+02</td>
<td style="text-align: right;">1.141500e+02</td>
<td style="text-align: right;">1.222100e+02</td>
<td style="text-align: right;">1.364200e+02</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">mutate</span>(df,<span class="at">date =</span> <span class="fu">ymd</span>(date))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 108
Columns: 9
$ date              &lt;date&gt; 2015-01-01, 2015-02-01, 2015-03-01, 2015-04-01, 201…
$ ADHK              &lt;dbl&gt; NA, NA, 20908.25, NA, NA, 21772.33, NA, NA, 24374.33…
$ prod_tbg          &lt;dbl&gt; 55258.07, 60589.93, 65392.61, 65309.37, 60522.22, 67…
$ kredit_konstruksi &lt;dbl&gt; 415006364126, 425296793497, 427231593289, 4268685445…
$ ekspor            &lt;dbl&gt; 63006048, 93951704, 95186751, 2977944, 287826539, 85…
$ pmi_jepang        &lt;dbl&gt; 52.2, 51.6, 50.3, 49.9, 50.9, 50.1, 51.2, 51.7, 51.0…
$ ihk               &lt;dbl&gt; 98.85237, 98.85837, 98.85527, 98.85477, 98.85197, 98…
$ soi               &lt;dbl&gt; -6.8, -7.8, 0.6, -11.3, -3.1, -13.7, -12.0, -14.7, -…
$ ikk               &lt;dbl&gt; 128.80, 123.50, 118.90, 114.30, 118.20, 121.10, 124.…</code></pre>
</div>
</div>
</section>
<section id="grafik-time-series" class="level2">
<h2 class="anchored" data-anchor-id="grafik-time-series">Grafik Time Series</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_time_series</span>(<span class="at">.data=</span><span class="fu">na.omit</span>(df),</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.date_var =</span> date,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.value =</span> ADHK,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.interactive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.title =</span>  <span class="st">"ADHK"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.smooth =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-55a4b4f0c10c748716a4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-55a4b4f0c10c748716a4">{"x":{"data":[{"x":["2015-03-01","2015-06-01","2015-09-01","2015-12-01","2016-03-01","2016-06-01","2016-12-01","2017-03-01","2017-06-01","2017-09-01","2017-12-01","2018-03-01","2018-06-01","2018-09-01","2018-12-01","2019-03-01","2019-06-01","2019-09-01","2019-12-01","2020-03-01","2020-06-01","2020-09-01","2020-12-01","2021-03-01","2021-06-01","2021-09-01","2021-12-01","2022-03-01","2022-06-01","2022-09-01","2022-12-01","2023-03-01","2023-06-01","2023-09-01","2023-12-01"],"y":[20908.25248374404,21772.328675940302,24374.334027248889,22283.070611894102,22642.587611175819,23601.375454395711,23121.844485519661,21900.939674178651,23227.806896269041,26216.93911944022,23262.523663377611,21902.121658271029,22931.43210456644,22560.134202729128,22955.44111643307,22278.275247701258,23403.919555955112,23996.11239211075,24194.131451733159,22945.513703232031,23108.487888401782,23765.241863749859,23469.630183956458,22674.932258046829,24211.197038823699,24340.7128142291,24211.013853100911,24428.428568851228,25661.558370508581,26069.732704650251,25914.354565935479,25296.319533738701,25267.420107010799,26480.342999999993,26862.533772200917],"text":["date: 2015-03-01<br />.value: 20908.25","date: 2015-06-01<br />.value: 21772.33","date: 2015-09-01<br />.value: 24374.33","date: 2015-12-01<br />.value: 22283.07","date: 2016-03-01<br />.value: 22642.59","date: 2016-06-01<br />.value: 23601.38","date: 2016-12-01<br />.value: 23121.84","date: 2017-03-01<br />.value: 21900.94","date: 2017-06-01<br />.value: 23227.81","date: 2017-09-01<br />.value: 26216.94","date: 2017-12-01<br />.value: 23262.52","date: 2018-03-01<br />.value: 21902.12","date: 2018-06-01<br />.value: 22931.43","date: 2018-09-01<br />.value: 22560.13","date: 2018-12-01<br />.value: 22955.44","date: 2019-03-01<br />.value: 22278.28","date: 2019-06-01<br />.value: 23403.92","date: 2019-09-01<br />.value: 23996.11","date: 2019-12-01<br />.value: 24194.13","date: 2020-03-01<br />.value: 22945.51","date: 2020-06-01<br />.value: 23108.49","date: 2020-09-01<br />.value: 23765.24","date: 2020-12-01<br />.value: 23469.63","date: 2021-03-01<br />.value: 22674.93","date: 2021-06-01<br />.value: 24211.20","date: 2021-09-01<br />.value: 24340.71","date: 2021-12-01<br />.value: 24211.01","date: 2022-03-01<br />.value: 24428.43","date: 2022-06-01<br />.value: 25661.56","date: 2022-09-01<br />.value: 26069.73","date: 2022-12-01<br />.value: 25914.35","date: 2023-03-01<br />.value: 25296.32","date: 2023-06-01<br />.value: 25267.42","date: 2023-09-01<br />.value: 26480.34","date: 2023-12-01<br />.value: 26862.53"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(44,62,80,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":25.570776255707766,"l":40.182648401826491},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724},"title":{"text":"ADHK","font":{"color":"rgba(44,62,80,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"date","autorange":true,"range":["2014-09-22","2024-05-08"],"tickmode":"auto","ticktext":["2016","2018","2020","2022","2024"],"tickvals":[16801,17532,18262,18993,19723],"categoryorder":"array","categoryarray":["2016","2018","2020","2022","2024"],"nticks":null,"ticks":"outside","tickcolor":"rgba(204,204,204,1)","ticklen":3.6529680365296811,"tickwidth":0.22139200221392005,"showticklabels":true,"tickfont":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.22139200221392005,"zeroline":false,"anchor":"y","title":{"text":"","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":true,"range":[20610.538419321194,27160.247836623763],"tickmode":"auto","ticktext":["22000","24000","26000"],"tickvals":[22000,24000,26000],"categoryorder":"array","categoryarray":["22000","24000","26000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(204,204,204,1)","ticklen":3.6529680365296811,"tickwidth":0.22139200221392005,"showticklabels":true,"tickfont":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.22139200221392005,"zeroline":false,"anchor":"x","title":{"text":"","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(44,62,80,1)","width":0.33208800332088001,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"6d5867cb6715":{"x":{},"y":{},"type":"scatter"}},"cur_data":"6d5867cb6715","visdat":{"6d5867cb6715":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>fungsi pembantu</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>multi_plot_time_series <span class="ot">&lt;-</span> <span class="cf">function</span>(data,date,<span class="at">exclude_var=</span><span class="cn">NULL</span>,<span class="at">.interactive=</span><span class="cn">TRUE</span>,<span class="at">n_col=</span><span class="dv">2</span>,<span class="at">n_row=</span><span class="dv">2</span>,<span class="at">.title=</span><span class="st">"Multiple Time Series"</span>){</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(exclude_var)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(date),<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">all_of</span>(date),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_time_series</span>(<span class="at">.data=</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.date_var =</span> date,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.value =</span> value,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.interactive =</span> .interactive,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.title =</span>  .title,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.facet_ncol =</span> n_col,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.facet_nrow =</span> n_row,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.smooth =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>}  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multi_plot_time_series</span>(df,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">date =</span> <span class="st">"date"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">exclude_var =</span> <span class="st">"ADHK"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">.interactive=</span><span class="cn">FALSE</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n_col =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AI-untuk-Nowcasting_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="grafik-time-series-differencing" class="level2">
<h2 class="anchored" data-anchor-id="grafik-time-series-differencing">Grafik Time Series Differencing</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tk_augment_differences</span>(<span class="at">.data=</span><span class="fu">na.omit</span>(df),</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.value =</span> ADHK,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.differences =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_time_series</span>(<span class="at">.date_var =</span> date,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.value =</span> ADHK_lag1_diff1,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.interactive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.title =</span>  <span class="st">"ADHK"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.smooth =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-b23cf3d77f60b00fdde7" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b23cf3d77f60b00fdde7">{"x":{"data":[{"x":["2015-03-01","2015-06-01","2015-09-01","2015-12-01","2016-03-01","2016-06-01","2016-12-01","2017-03-01","2017-06-01","2017-09-01","2017-12-01","2018-03-01","2018-06-01","2018-09-01","2018-12-01","2019-03-01","2019-06-01","2019-09-01","2019-12-01","2020-03-01","2020-06-01","2020-09-01","2020-12-01","2021-03-01","2021-06-01","2021-09-01","2021-12-01","2022-03-01","2022-06-01","2022-09-01","2022-12-01","2023-03-01","2023-06-01","2023-09-01","2023-12-01"],"y":[null,864.07619219626213,2602.0053513085877,-2091.2634153547879,359.51699928171729,958.78784321989224,-479.53096887604988,-1220.9048113410099,1326.86722209039,2989.1322231711783,-2954.4154560626084,-1360.4020051065818,1029.3104462954107,-371.29790183731166,395.30691370394197,-677.16586873181222,1125.6443082538535,592.19283615563836,198.01905962240926,-1248.6177485011285,162.97418516975085,656.7539753480778,-295.61167979340098,-794.6979259096297,1536.2647807768699,129.51577540540166,-129.69896112818969,217.41471575031755,1233.1298016573528,408.17433414166953,-155.37813871477192,-618.03503219677805,-28.8994267279013,1212.9228929891942,382.19077220092367],"text":["date: 2015-03-01<br />.value:          NA","date: 2015-06-01<br />.value:   864.07619","date: 2015-09-01<br />.value:  2602.00535","date: 2015-12-01<br />.value: -2091.26342","date: 2016-03-01<br />.value:   359.51700","date: 2016-06-01<br />.value:   958.78784","date: 2016-12-01<br />.value:  -479.53097","date: 2017-03-01<br />.value: -1220.90481","date: 2017-06-01<br />.value:  1326.86722","date: 2017-09-01<br />.value:  2989.13222","date: 2017-12-01<br />.value: -2954.41546","date: 2018-03-01<br />.value: -1360.40201","date: 2018-06-01<br />.value:  1029.31045","date: 2018-09-01<br />.value:  -371.29790","date: 2018-12-01<br />.value:   395.30691","date: 2019-03-01<br />.value:  -677.16587","date: 2019-06-01<br />.value:  1125.64431","date: 2019-09-01<br />.value:   592.19284","date: 2019-12-01<br />.value:   198.01906","date: 2020-03-01<br />.value: -1248.61775","date: 2020-06-01<br />.value:   162.97419","date: 2020-09-01<br />.value:   656.75398","date: 2020-12-01<br />.value:  -295.61168","date: 2021-03-01<br />.value:  -794.69793","date: 2021-06-01<br />.value:  1536.26478","date: 2021-09-01<br />.value:   129.51578","date: 2021-12-01<br />.value:  -129.69896","date: 2022-03-01<br />.value:   217.41472","date: 2022-06-01<br />.value:  1233.12980","date: 2022-09-01<br />.value:   408.17433","date: 2022-12-01<br />.value:  -155.37814","date: 2023-03-01<br />.value:  -618.03503","date: 2023-06-01<br />.value:   -28.89943","date: 2023-09-01<br />.value:  1212.92289","date: 2023-12-01<br />.value:   382.19077"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(44,62,80,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":25.570776255707766,"l":40.182648401826491},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724},"title":{"text":"ADHK","font":{"color":"rgba(44,62,80,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"date","autorange":true,"range":["2014-09-22","2024-05-08"],"tickmode":"auto","ticktext":["2016","2018","2020","2022","2024"],"tickvals":[16801,17532,18262,18993,19723],"categoryorder":"array","categoryarray":["2016","2018","2020","2022","2024"],"nticks":null,"ticks":"outside","tickcolor":"rgba(204,204,204,1)","ticklen":3.6529680365296811,"tickwidth":0.22139200221392005,"showticklabels":true,"tickfont":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.22139200221392005,"zeroline":false,"anchor":"y","title":{"text":"","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":true,"range":[-3251.5928400242979,3286.3096071328678],"tickmode":"auto","ticktext":["-2000","0","2000"],"tickvals":[-2000,0,1999.9999999999995],"categoryorder":"array","categoryarray":["-2000","0","2000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(204,204,204,1)","ticklen":3.6529680365296811,"tickwidth":0.22139200221392005,"showticklabels":true,"tickfont":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.22139200221392005,"zeroline":false,"anchor":"x","title":{"text":"","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(44,62,80,1)","width":0.33208800332088001,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"6d585ef23ef2":{"x":{},"y":{},"type":"scatter"}},"cur_data":"6d585ef23ef2","visdat":{"6d585ef23ef2":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="multi-input-multi-output-mimo" class="level2">
<h2 class="anchored" data-anchor-id="multi-input-multi-output-mimo">Multi Input Multi Output (MIMO)</h2>
<section id="fungsi-pembantu" class="level3">
<h3 class="anchored" data-anchor-id="fungsi-pembantu">Fungsi pembantu</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>prepare_mimo_data <span class="ot">&lt;-</span> <span class="cf">function</span>(data,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                              date_col,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                              input_vars,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                              output_vars,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lags       =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">horizon    =</span> <span class="dv">1</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">remove_na  =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tidyeval the date column</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  date_col <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">enquo</span>(date_col)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) Order by time index</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  df_prep <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="sc">!!</span>date_col)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) Generate lagged inputs via timetk</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    Creates columns like: sales_lag1, sales_lag2, ..., price_lag1, ...</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  df_prep <span class="ot">&lt;-</span> df_prep <span class="sc">%&gt;%</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    timetk<span class="sc">::</span><span class="fu">tk_augment_lags</span>(</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">.value =</span> <span class="fu">all_of</span>(input_vars),</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">.lags  =</span> lags</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) Generate future targets via dplyr::lead()</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    Creates columns like: sales_h1, sales_h2, ...</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  df_prep <span class="ot">&lt;-</span> df_prep <span class="sc">%&gt;%</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    timetk<span class="sc">::</span><span class="fu">tk_augment_leads</span>(</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">.value =</span> <span class="fu">all_of</span>(output_vars),</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">.lags  =</span> <span class="sc">-</span>horizon</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Build vector of all generated column names</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    lag_cols    <span class="ot">&lt;-</span> df_prep <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"lag"</span>)) <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    lead_cols   <span class="ot">&lt;-</span> df_prep <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"lead"</span>)) <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    all_new_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sort</span>(lag_cols,<span class="at">decreasing =</span> <span class="cn">TRUE</span>), lead_cols)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4) Optionally drop rows with NAs in any of the new columns</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (remove_na) {</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    df_prep <span class="ot">&lt;-</span> df_prep <span class="sc">%&gt;%</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">drop_na</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(all_new_cols))</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the prepared tibble</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>  df_prep <span class="ot">&lt;-</span> df_prep <span class="sc">%&gt;%</span> </span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!!</span>date_col,</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">all_of</span>(all_new_cols)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"date_lg0"</span><span class="ot">=</span><span class="sc">!!</span>date_col)</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>  <span class="co">#nm_df_prep &lt;- df_prep %&gt;% select(-!!date_col) %&gt;% names()</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#date_nm &lt;- df_prep %&gt;% select(!!date_col) %&gt;% names()</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>  <span class="co">#names(df_prep) &lt;- c(date_nm,sort(nm_df_prep,decreasing = FALSE))</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df_prep)</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="struktur-data-mimo" class="level3">
<h3 class="anchored" data-anchor-id="struktur-data-mimo">Struktur Data MIMO</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prepare_mimo_data</span>(<span class="at">data =</span> <span class="fu">na.omit</span>(df),</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">date_col =</span> date,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">input_vars =</span> <span class="fu">c</span>(<span class="st">"ADHK"</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">output_vars =</span> <span class="fu">c</span>(<span class="st">"ADHK"</span>),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lags =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">remove_na =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">horizon =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 35 × 8
   date_lg0   ADHK_lag2 ADHK_lag1 ADHK_lag0 ADHK_lead1 ADHK_lead2 ADHK_lead3
   &lt;date&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1 2015-03-01       NA        NA     20908.     21772.     24374.     22283.
 2 2015-06-01       NA     20908.    21772.     24374.     22283.     22643.
 3 2015-09-01    20908.    21772.    24374.     22283.     22643.     23601.
 4 2015-12-01    21772.    24374.    22283.     22643.     23601.     23122.
 5 2016-03-01    24374.    22283.    22643.     23601.     23122.     21901.
 6 2016-06-01    22283.    22643.    23601.     23122.     21901.     23228.
 7 2016-12-01    22643.    23601.    23122.     21901.     23228.     26217.
 8 2017-03-01    23601.    23122.    21901.     23228.     26217.     23263.
 9 2017-06-01    23122.    21901.    23228.     26217.     23263.     21902.
10 2017-09-01    21901.    23228.    26217.     23263.     21902.     22931.
# ℹ 25 more rows
# ℹ 1 more variable: ADHK_lead4 &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="lstm" class="level2">
<h2 class="anchored" data-anchor-id="lstm">LSTM</h2>
<section id="fungsi-pembantu-lstm" class="level3">
<h3 class="anchored" data-anchor-id="fungsi-pembantu-lstm">Fungsi pembantu LSTM</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>train_lstm_mimo <span class="ot">&lt;-</span> <span class="cf">function</span>(data,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                            date_col,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                            input_cols,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                            output_cols,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">val_split    =</span> <span class="fl">0.2</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">epochs       =</span> <span class="dv">50</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">batch_size   =</span> <span class="dv">32</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">lr           =</span> <span class="fl">1e-3</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">optimizer    =</span> <span class="fu">c</span>(<span class="st">"adam"</span>,<span class="st">"sgd"</span>),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">hidden_size  =</span> <span class="dv">50</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">num_layers   =</span> <span class="dv">1</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">activation   =</span> <span class="fu">c</span>(<span class="st">"tanh"</span>,<span class="st">"relu"</span>,<span class="st">"linear"</span>),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">dropout      =</span> <span class="fl">0.0</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>                            <span class="at">weight_decay =</span> <span class="fl">0.0</span>) {</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  optimizer <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(optimizer)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  activation <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(activation)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  date_col   <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">ensym</span>(date_col)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) Order by time index</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">!!</span>date_col)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) Split data</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  n     <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  n_val <span class="ot">&lt;-</span> <span class="fu">floor</span>(val_split <span class="sc">*</span> n)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  train_df <span class="ot">&lt;-</span> data[<span class="dv">1</span><span class="sc">:</span>(n <span class="sc">-</span> n_val), ]</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  val_df   <span class="ot">&lt;-</span> data[(n <span class="sc">-</span> n_val <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n, ]</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) Compute robust scaler on train_df</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  input_median  <span class="ot">&lt;-</span> <span class="fu">sapply</span>(input_cols, <span class="cf">function</span>(col) <span class="fu">median</span>(train_df[[col]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  input_iqr     <span class="ot">&lt;-</span> <span class="fu">sapply</span>(input_cols, <span class="cf">function</span>(col) <span class="fu">IQR</span>(train_df[[col]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  output_median <span class="ot">&lt;-</span> <span class="fu">sapply</span>(output_cols,<span class="cf">function</span>(col) <span class="fu">median</span>(train_df[[col]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  output_iqr    <span class="ot">&lt;-</span> <span class="fu">sapply</span>(output_cols,<span class="cf">function</span>(col) <span class="fu">IQR</span>(train_df[[col]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  scaler <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">input_median  =</span> input_median,</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">input_iqr     =</span> input_iqr,</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_median =</span> output_median,</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_iqr    =</span> output_iqr</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4) Apply scaling to train and validation sets</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> input_cols) {</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    train_df[[col]] <span class="ot">&lt;-</span> (train_df[[col]] <span class="sc">-</span> scaler<span class="sc">$</span>input_median[col]) <span class="sc">/</span> scaler<span class="sc">$</span>input_iqr[col]</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    val_df[[col]]   <span class="ot">&lt;-</span> (val_df[[col]]   <span class="sc">-</span> scaler<span class="sc">$</span>input_median[col]) <span class="sc">/</span> scaler<span class="sc">$</span>input_iqr[col]</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> output_cols) {</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    train_df[[col]] <span class="ot">&lt;-</span> (train_df[[col]] <span class="sc">-</span> scaler<span class="sc">$</span>output_median[col]) <span class="sc">/</span> scaler<span class="sc">$</span>output_iqr[col]</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    val_df[[col]]   <span class="ot">&lt;-</span> (val_df[[col]]   <span class="sc">-</span> scaler<span class="sc">$</span>output_median[col]) <span class="sc">/</span> scaler<span class="sc">$</span>output_iqr[col]</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 5) Define the LSTM module</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>  LSTMModel <span class="ot">&lt;-</span> <span class="fu">nn_module</span>(</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LSTMModel"</span>,</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">initialize =</span> <span class="cf">function</span>(input_size, hidden_size, num_layers, dropout, output_size, activation) {</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>lstm <span class="ot">&lt;-</span> <span class="fu">nn_lstm</span>(</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">input_size  =</span> input_size,</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">hidden_size =</span> hidden_size,</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">num_layers  =</span> num_layers,</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">batch_first =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">dropout     =</span> dropout</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>fc  <span class="ot">&lt;-</span> <span class="fu">nn_linear</span>(hidden_size, output_size)</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>act <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>        activation,</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">tanh   =</span> <span class="fu">nn_tanh</span>(),</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">relu   =</span> <span class="fu">nn_relu</span>(),</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">linear =</span> <span class="fu">nn_identity</span>()</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">forward =</span> <span class="cf">function</span>(x) {</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>      out    <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">lstm</span>(x)</span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>      h_last <span class="ot">&lt;-</span> out[[<span class="dv">1</span>]][ , <span class="fu">dim</span>(out[[<span class="dv">1</span>]])[<span class="dv">2</span>], ]</span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>      h_act  <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">act</span>(h_last)</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span><span class="fu">fc</span>(h_act)</span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 6) Prepare torch datasets</span></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>  make_ds <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>    x_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(df[, input_cols])</span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>    y_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(df[, output_cols])</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>    X <span class="ot">&lt;-</span> <span class="fu">torch_tensor</span>(x_mat, <span class="at">dtype =</span> <span class="fu">torch_float</span>())<span class="sc">$</span><span class="fu">view</span>(<span class="fu">c</span>(<span class="fu">nrow</span>(x_mat), <span class="sc">-</span><span class="dv">1</span>, <span class="fu">length</span>(input_cols)))</span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>    Y <span class="ot">&lt;-</span> <span class="fu">torch_tensor</span>(y_mat, <span class="at">dtype =</span> <span class="fu">torch_float</span>())</span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y)</span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>  train_ds <span class="ot">&lt;-</span> <span class="fu">make_ds</span>(train_df)</span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>  val_ds   <span class="ot">&lt;-</span> <span class="fu">make_ds</span>(val_df)</span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 7) Instantiate model and optimizer</span></span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">LSTMModel</span>(</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">input_size  =</span> <span class="fu">length</span>(input_cols),</span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">hidden_size =</span> hidden_size,</span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_layers  =</span> num_layers,</span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">dropout     =</span> dropout,</span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_size =</span> <span class="fu">length</span>(output_cols),</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">activation  =</span> activation</span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>  optim <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>    optimizer,</span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">adam =</span> <span class="fu">optim_adam</span>(model<span class="sc">$</span>parameters, <span class="at">lr =</span> lr, <span class="at">weight_decay =</span> weight_decay),</span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">sgd  =</span> <span class="fu">optim_sgd</span>(model<span class="sc">$</span>parameters, <span class="at">lr =</span> lr, <span class="at">weight_decay =</span> weight_decay)</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>  criterion <span class="ot">&lt;-</span> <span class="fu">nn_mse_loss</span>()</span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 8) Training loop</span></span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>  train_loss <span class="ot">&lt;-</span> <span class="fu">numeric</span>(epochs)</span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>  val_loss   <span class="ot">&lt;-</span> <span class="fu">numeric</span>(epochs)</span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (e <span class="cf">in</span> <span class="fu">seq_len</span>(epochs)) {</span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>    model<span class="sc">$</span><span class="fu">train</span>()</span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>    optim<span class="sc">$</span><span class="fu">zero_grad</span>()</span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>    preds_train <span class="ot">&lt;-</span> <span class="fu">model</span>(train_ds<span class="sc">$</span>x)</span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>    loss_train  <span class="ot">&lt;-</span> <span class="fu">criterion</span>(preds_train, train_ds<span class="sc">$</span>y)</span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>    loss_train<span class="sc">$</span><span class="fu">backward</span>()</span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>    optim<span class="sc">$</span><span class="fu">step</span>()</span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>    train_loss[e] <span class="ot">&lt;-</span> loss_train<span class="sc">$</span><span class="fu">item</span>()</span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>    model<span class="sc">$</span><span class="fu">eval</span>()</span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with_no_grad</span>({</span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a>      preds_val    <span class="ot">&lt;-</span> <span class="fu">model</span>(val_ds<span class="sc">$</span>x)</span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a>      val_loss[e]  <span class="ot">&lt;-</span> <span class="fu">criterion</span>(preds_val, val_ds<span class="sc">$</span>y)<span class="sc">$</span><span class="fu">item</span>()</span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">model       =</span> model,</span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">train_loss  =</span> train_loss,</span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">val_loss    =</span> val_loss,</span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">scaler      =</span> scaler,</span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">input_cols  =</span> input_cols,</span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_cols =</span> output_cols,</span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_col    =</span> rlang<span class="sc">::</span><span class="fu">as_string</span>(date_col)</span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plot_lstm_history <span class="ot">&lt;-</span> <span class="cf">function</span>(history) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">epoch =</span> <span class="fu">seq_along</span>(history<span class="sc">$</span>train_loss),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">training =</span> <span class="fu">sqrt</span>(history<span class="sc">$</span>train_loss),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">validation =</span> <span class="fu">sqrt</span>(history<span class="sc">$</span>val_loss)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span>epoch, <span class="at">names_to =</span> <span class="st">"data"</span>, <span class="at">values_to =</span> <span class="st">"loss"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(epoch, loss, <span class="at">color =</span> data)) <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Training vs Validation Loss"</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x     =</span> <span class="st">"Epoch"</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">y     =</span> <span class="st">"RMSE"</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>predict_lstm <span class="ot">&lt;-</span> <span class="cf">function</span>(history, new_data) {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  model       <span class="ot">&lt;-</span> history<span class="sc">$</span>model</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  scaler      <span class="ot">&lt;-</span> history<span class="sc">$</span>scaler</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  input_cols  <span class="ot">&lt;-</span> history<span class="sc">$</span>input_cols</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  output_cols <span class="ot">&lt;-</span> history<span class="sc">$</span>output_cols</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  date_col    <span class="ot">&lt;-</span> history<span class="sc">$</span>date_col</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  dates <span class="ot">&lt;-</span> new_data[[date_col]]</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  x_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(new_data[, input_cols])</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  X     <span class="ot">&lt;-</span> <span class="fu">torch_tensor</span>(x_mat, <span class="at">dtype =</span> <span class="fu">torch_float</span>())<span class="sc">$</span><span class="fu">view</span>(<span class="fu">c</span>(<span class="fu">nrow</span>(x_mat), <span class="sc">-</span><span class="dv">1</span>, <span class="fu">ncol</span>(x_mat)))</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  model<span class="sc">$</span><span class="fu">eval</span>()</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with_no_grad</span>({ pred_scaled <span class="ot">&lt;-</span> <span class="fu">model</span>(X) })</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  pred_scaled_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pred_scaled)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inverse robust scaling</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  pred_orig <span class="ot">&lt;-</span> <span class="fu">sweep</span>(pred_scaled_mat, <span class="dv">2</span>, scaler<span class="sc">$</span>output_iqr, <span class="st">`</span><span class="at">*</span><span class="st">`</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  pred_orig <span class="ot">&lt;-</span> <span class="fu">sweep</span>(pred_orig, <span class="dv">2</span>, scaler<span class="sc">$</span>output_median, <span class="st">`</span><span class="at">+</span><span class="st">`</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Build output tibble</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  pred_df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(pred_orig)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(pred_df) <span class="ot">&lt;-</span> output_cols</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">date =</span> dates) <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(pred_df)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>forecast_lstm <span class="ot">&lt;-</span> <span class="cf">function</span>(history,output_var,train_data,<span class="at">test_data=</span><span class="cn">NULL</span>){</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  forecast <span class="ot">&lt;-</span> <span class="fu">predict_lstm</span>(<span class="at">history =</span> history,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">new_data =</span> train_data <span class="sc">%&gt;%</span> <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">where</span>(is.Date),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">values_to =</span> <span class="st">"forecast"</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                                         )</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>new_dates <span class="ot">&lt;-</span>  train_data <span class="sc">%&gt;%</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(<span class="fu">where</span>(is.Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">pull</span>()</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="fu">nrow</span>(forecast))) {</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  new_dates[i<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">ymd</span>(new_dates[i]) <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">3</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">date=</span>new_dates[<span class="sc">-</span><span class="dv">1</span>],</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">forecast =</span> forecast <span class="sc">%&gt;%</span> <span class="fu">pull</span>(forecast)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span> </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">where</span>(is.Date),<span class="fu">all_of</span>(output_var)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">where</span>(is.Date),<span class="at">names_to =</span> <span class="st">"type"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type=</span><span class="st">"actual"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.Date),<span class="at">.fn =</span> <span class="cf">function</span>(x) <span class="st">"date"</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="sc">%&gt;%</span> </span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">where</span>(is.Date),<span class="at">names_to =</span> <span class="st">"type"</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="at">.cols=</span><span class="fu">where</span>(is.Date),<span class="at">.fn =</span>  <span class="cf">function</span>(x) <span class="st">"date"</span> )</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(test_data)){</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> test_data <span class="sc">%&gt;%</span> </span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(<span class="fu">where</span>(is.Date),<span class="fu">all_of</span>(output_var)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>              <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">where</span>(is.Date),<span class="at">names_to =</span> <span class="st">"type"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">type=</span><span class="st">"actual"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.Date),<span class="at">.fn =</span> <span class="cf">function</span>(x) <span class="st">"date"</span> )</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(result,test_data)</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(result)</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="satu-variabel" class="level3">
<h3 class="anchored" data-anchor-id="satu-variabel">Satu Variabel</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mimo_df1 <span class="ot">&lt;-</span> <span class="fu">prepare_mimo_data</span>(<span class="at">data =</span> <span class="fu">na.omit</span>(df),</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">date_col =</span> date,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">input_vars =</span> <span class="fu">c</span>(<span class="st">"ADHK"</span>),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">output_vars =</span> <span class="fu">c</span>(<span class="st">"ADHK"</span>),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lags =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">remove_na =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">horizon =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>mimo_df1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 29 × 8
   date_lg0   ADHK_lag2 ADHK_lag1 ADHK_lag0 ADHK_lead1 ADHK_lead2 ADHK_lead3
   &lt;date&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1 2015-09-01    20908.    21772.    24374.     22283.     22643.     23601.
 2 2015-12-01    21772.    24374.    22283.     22643.     23601.     23122.
 3 2016-03-01    24374.    22283.    22643.     23601.     23122.     21901.
 4 2016-06-01    22283.    22643.    23601.     23122.     21901.     23228.
 5 2016-12-01    22643.    23601.    23122.     21901.     23228.     26217.
 6 2017-03-01    23601.    23122.    21901.     23228.     26217.     23263.
 7 2017-06-01    23122.    21901.    23228.     26217.     23263.     21902.
 8 2017-09-01    21901.    23228.    26217.     23263.     21902.     22931.
 9 2017-12-01    23228.    26217.    23263.     21902.     22931.     22560.
10 2018-03-01    26217.    23263.    21902.     22931.     22560.     22955.
# ℹ 19 more rows
# ℹ 1 more variable: ADHK_lead4 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>train_df <span class="ot">&lt;-</span> mimo_df1 <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(date_lg0<span class="sc">&lt;</span><span class="st">"2022-01-01"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>train_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 8
   date_lg0   ADHK_lag2 ADHK_lag1 ADHK_lag0 ADHK_lead1 ADHK_lead2 ADHK_lead3
   &lt;date&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1 2015-09-01    20908.    21772.    24374.     22283.     22643.     23601.
 2 2015-12-01    21772.    24374.    22283.     22643.     23601.     23122.
 3 2016-03-01    24374.    22283.    22643.     23601.     23122.     21901.
 4 2016-06-01    22283.    22643.    23601.     23122.     21901.     23228.
 5 2016-12-01    22643.    23601.    23122.     21901.     23228.     26217.
 6 2017-03-01    23601.    23122.    21901.     23228.     26217.     23263.
 7 2017-06-01    23122.    21901.    23228.     26217.     23263.     21902.
 8 2017-09-01    21901.    23228.    26217.     23263.     21902.     22931.
 9 2017-12-01    23228.    26217.    23263.     21902.     22931.     22560.
10 2018-03-01    26217.    23263.    21902.     22931.     22560.     22955.
# ℹ 15 more rows
# ℹ 1 more variable: ADHK_lead4 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>test_df <span class="ot">&lt;-</span> mimo_df1 <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(date_lg0<span class="sc">&gt;=</span><span class="st">"2022-01-01"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>test_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 8
  date_lg0   ADHK_lag2 ADHK_lag1 ADHK_lag0 ADHK_lead1 ADHK_lead2 ADHK_lead3
  &lt;date&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
1 2022-03-01    24341.    24211.    24428.     25662.     26070.     25914.
2 2022-06-01    24211.    24428.    25662.     26070.     25914.     25296.
3 2022-09-01    24428.    25662.    26070.     25914.     25296.     25267.
4 2022-12-01    25662.    26070.    25914.     25296.     25267.     26480.
# ℹ 1 more variable: ADHK_lead4 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>input_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">select</span>(train_df,<span class="fu">contains</span>(<span class="st">"lag"</span>)))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>input_cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ADHK_lag2" "ADHK_lag1" "ADHK_lag0"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>output_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">select</span>(train_df,<span class="fu">contains</span>(<span class="st">"lead"</span>)))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>output_cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ADHK_lead1" "ADHK_lead2" "ADHK_lead3" "ADHK_lead4"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">train_lstm_mimo</span>(<span class="at">data =</span> train_df,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">input_cols =</span> input_cols,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">output_cols =</span> output_cols,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">date_col =</span> <span class="st">"date_lg0"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">val_split =</span> <span class="fl">0.2</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">epochs =</span> <span class="dv">75</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">batch_size =</span> <span class="dv">32</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">optimizer =</span> <span class="st">"adam"</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hidden_size =</span> <span class="dv">10</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">num_layers =</span> <span class="dv">1</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">activation =</span> <span class="st">"linear"</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>mod<span class="sc">$</span>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An `nn_module` containing 644 parameters.

── Modules ─────────────────────────────────────────────────────────────────────
• lstm: &lt;nn_lstm&gt; #600 parameters
• fc: &lt;nn_linear&gt; #44 parameters
• act: &lt;nn_identity&gt; #0 parameters</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_lstm_history</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AI-untuk-Nowcasting_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>res1 <span class="ot">&lt;-</span> <span class="fu">forecast_lstm</span>(<span class="at">history =</span> mod,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">output_var =</span> <span class="st">"ADHK_lag0"</span>,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">train_data =</span> train_df,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">test_data =</span> test_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if
`.name_repair` is omitted as of tibble 2.0.0.
ℹ Using compatibility `.name_repair`.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>res1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">"forecast"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  date       type      value
  &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt;
1 2022-03-01 forecast 22749.
2 2022-06-01 forecast 23291.
3 2022-09-01 forecast 23063.
4 2022-12-01 forecast 23114.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>yardstick<span class="sc">::</span><span class="fu">rmse_vec</span>(<span class="at">truth =</span> <span class="fu">filter</span>(res1,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"actual"</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                                   date<span class="sc">&gt;=</span><span class="st">"2022-01-01"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">estimate =</span> <span class="fu">filter</span>(res1,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"forecast"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                                   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2516.231</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MAPE</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>yardstick<span class="sc">::</span><span class="fu">mape_vec</span>(<span class="at">truth =</span> <span class="fu">filter</span>(res1,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"actual"</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                                   date<span class="sc">&gt;=</span><span class="st">"2022-01-01"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">estimate =</span> <span class="fu">filter</span>(res1,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"forecast"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>                                   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.613787</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_time_series</span>(<span class="at">.data=</span>res1,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.date_var =</span> date,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.value =</span> value,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.interactive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.title =</span>  <span class="st">"Forecast Plot"</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.color_var =</span> type,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.legend_show =</span> <span class="cn">FALSE</span>,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.smooth =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-1cca4d363fb3bb1108c5" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-1cca4d363fb3bb1108c5">{"x":{"data":[{"x":["2015-09-01","2015-12-01","2016-03-01","2016-06-01","2016-12-01","2017-03-01","2017-06-01","2017-09-01","2017-12-01","2018-03-01","2018-06-01","2018-09-01","2018-12-01","2019-03-01","2019-06-01","2019-09-01","2019-12-01","2020-03-01","2020-06-01","2020-09-01","2020-12-01","2021-03-01","2021-06-01","2021-09-01","2021-12-01","2022-03-01","2022-06-01","2022-09-01","2022-12-01"],"y":[24374.334027248889,22283.070611894102,22642.587611175819,23601.375454395711,23121.844485519661,21900.939674178651,23227.806896269041,26216.93911944022,23262.523663377611,21902.121658271029,22931.43210456644,22560.134202729128,22955.44111643307,22278.275247701258,23403.919555955112,23996.11239211075,24194.131451733159,22945.513703232031,23108.487888401782,23765.241863749859,23469.630183956458,22674.932258046829,24211.197038823699,24340.7128142291,24211.013853100911,24428.428568851228,25661.558370508581,26069.732704650251,25914.354565935479],"text":["date: 2015-09-01<br />.value: 24374.33<br />.color_mod: actual<br />.color_mod: actual","date: 2015-12-01<br />.value: 22283.07<br />.color_mod: actual<br />.color_mod: actual","date: 2016-03-01<br />.value: 22642.59<br />.color_mod: actual<br />.color_mod: actual","date: 2016-06-01<br />.value: 23601.38<br />.color_mod: actual<br />.color_mod: actual","date: 2016-12-01<br />.value: 23121.84<br />.color_mod: actual<br />.color_mod: actual","date: 2017-03-01<br />.value: 21900.94<br />.color_mod: actual<br />.color_mod: actual","date: 2017-06-01<br />.value: 23227.81<br />.color_mod: actual<br />.color_mod: actual","date: 2017-09-01<br />.value: 26216.94<br />.color_mod: actual<br />.color_mod: actual","date: 2017-12-01<br />.value: 23262.52<br />.color_mod: actual<br />.color_mod: actual","date: 2018-03-01<br />.value: 21902.12<br />.color_mod: actual<br />.color_mod: actual","date: 2018-06-01<br />.value: 22931.43<br />.color_mod: actual<br />.color_mod: actual","date: 2018-09-01<br />.value: 22560.13<br />.color_mod: actual<br />.color_mod: actual","date: 2018-12-01<br />.value: 22955.44<br />.color_mod: actual<br />.color_mod: actual","date: 2019-03-01<br />.value: 22278.28<br />.color_mod: actual<br />.color_mod: actual","date: 2019-06-01<br />.value: 23403.92<br />.color_mod: actual<br />.color_mod: actual","date: 2019-09-01<br />.value: 23996.11<br />.color_mod: actual<br />.color_mod: actual","date: 2019-12-01<br />.value: 24194.13<br />.color_mod: actual<br />.color_mod: actual","date: 2020-03-01<br />.value: 22945.51<br />.color_mod: actual<br />.color_mod: actual","date: 2020-06-01<br />.value: 23108.49<br />.color_mod: actual<br />.color_mod: actual","date: 2020-09-01<br />.value: 23765.24<br />.color_mod: actual<br />.color_mod: actual","date: 2020-12-01<br />.value: 23469.63<br />.color_mod: actual<br />.color_mod: actual","date: 2021-03-01<br />.value: 22674.93<br />.color_mod: actual<br />.color_mod: actual","date: 2021-06-01<br />.value: 24211.20<br />.color_mod: actual<br />.color_mod: actual","date: 2021-09-01<br />.value: 24340.71<br />.color_mod: actual<br />.color_mod: actual","date: 2021-12-01<br />.value: 24211.01<br />.color_mod: actual<br />.color_mod: actual","date: 2022-03-01<br />.value: 24428.43<br />.color_mod: actual<br />.color_mod: actual","date: 2022-06-01<br />.value: 25661.56<br />.color_mod: actual<br />.color_mod: actual","date: 2022-09-01<br />.value: 26069.73<br />.color_mod: actual<br />.color_mod: actual","date: 2022-12-01<br />.value: 25914.35<br />.color_mod: actual<br />.color_mod: actual"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(44,62,80,1)","dash":"solid"},"hoveron":"points","name":"actual","legendgroup":"actual","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":["2022-03-01","2022-06-01","2022-09-01","2022-12-01"],"y":[22748.786899234743,23290.688226072976,23063.207063483856,23113.594480195112],"text":["date: 2022-03-01<br />.value: 22748.79<br />.color_mod: forecast<br />.color_mod: forecast","date: 2022-06-01<br />.value: 23290.69<br />.color_mod: forecast<br />.color_mod: forecast","date: 2022-09-01<br />.value: 23063.21<br />.color_mod: forecast<br />.color_mod: forecast","date: 2022-12-01<br />.value: 23113.59<br />.color_mod: forecast<br />.color_mod: forecast"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(227,26,28,1)","dash":"solid"},"hoveron":"points","name":"forecast","legendgroup":"forecast","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":25.570776255707766,"l":40.182648401826491},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724},"title":{"text":"Forecast Plot","font":{"color":"rgba(44,62,80,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"date","autorange":true,"range":["2015-04-21","2023-04-12"],"tickmode":"auto","ticktext":["2016","2018","2020","2022"],"tickvals":[16801,17532,18262,18993],"categoryorder":"array","categoryarray":["2016","2018","2020","2022"],"nticks":null,"ticks":"outside","tickcolor":"rgba(204,204,204,1)","ticklen":3.6529680365296811,"tickwidth":0.22139200221392005,"showticklabels":true,"tickfont":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.22139200221392005,"zeroline":false,"anchor":"y","title":{"text":"","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":true,"range":[21685.139701915574,26432.739091703297],"tickmode":"auto","ticktext":["22000","23000","24000","25000","26000"],"tickvals":[22000,23000,24000,25000,26000],"categoryorder":"array","categoryarray":["22000","23000","24000","25000","26000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(204,204,204,1)","ticklen":3.6529680365296811,"tickwidth":0.22139200221392005,"showticklabels":true,"tickfont":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.22139200221392005,"zeroline":false,"anchor":"x","title":{"text":"","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(44,62,80,1)","width":0.33208800332088001,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"6d584d735f2b":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"6d584d735f2b","visdat":{"6d584d735f2b":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="multi-variabel" class="level3">
<h3 class="anchored" data-anchor-id="multi-variabel">Multi Variabel</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#input_vars &lt;- names(select(df,-c(date,ADHK)))</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>input_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ekspor"</span>,<span class="st">"ihk"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>input_vars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ekspor" "ihk"   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mimo_df2 <span class="ot">&lt;-</span> <span class="fu">prepare_mimo_data</span>(<span class="at">data =</span> <span class="fu">na.omit</span>(df),</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">date_col =</span> date,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">input_vars =</span> <span class="fu">c</span>(<span class="st">"ADHK"</span>,input_vars),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">output_vars =</span> <span class="fu">c</span>(<span class="st">"ADHK"</span>),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lags =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">remove_na =</span> <span class="cn">TRUE</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">horizon =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>mimo_df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 29 × 14
   date_lg0   ihk_lag2 ihk_lag1 ihk_lag0 ekspor_lag2 ekspor_lag1 ekspor_lag0
   &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1 2015-09-01     98.9     98.9     98.8    95186751    85868149   146184552
 2 2015-12-01     98.9     98.8     98.8    85868149   146184552   277363045
 3 2016-03-01     98.8     98.8     98.8   146184552   277363045    80837466
 4 2016-06-01     98.8     98.8     98.8   277363045    80837466   256450298
 5 2016-12-01     98.8     98.8     98.8    80837466   256450298   195677273
 6 2017-03-01     98.8     98.8     98.8   256450298   195677273   135640406
 7 2017-06-01     98.8     98.8     98.8   195677273   135640406    59935547
 8 2017-09-01     98.8     98.8     98.8   135640406    59935547    75541458
 9 2017-12-01     98.8     98.8     98.8    59935547    75541458   158378320
10 2018-03-01     98.8     98.8     98.9    75541458   158378320    43910678
# ℹ 19 more rows
# ℹ 7 more variables: ADHK_lag2 &lt;dbl&gt;, ADHK_lag1 &lt;dbl&gt;, ADHK_lag0 &lt;dbl&gt;,
#   ADHK_lead1 &lt;dbl&gt;, ADHK_lead2 &lt;dbl&gt;, ADHK_lead3 &lt;dbl&gt;, ADHK_lead4 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>train_df <span class="ot">&lt;-</span> mimo_df2 <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(date_lg0<span class="sc">&lt;</span><span class="st">"2022-01-01"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>train_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 14
   date_lg0   ihk_lag2 ihk_lag1 ihk_lag0 ekspor_lag2 ekspor_lag1 ekspor_lag0
   &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1 2015-09-01     98.9     98.9     98.8    95186751    85868149   146184552
 2 2015-12-01     98.9     98.8     98.8    85868149   146184552   277363045
 3 2016-03-01     98.8     98.8     98.8   146184552   277363045    80837466
 4 2016-06-01     98.8     98.8     98.8   277363045    80837466   256450298
 5 2016-12-01     98.8     98.8     98.8    80837466   256450298   195677273
 6 2017-03-01     98.8     98.8     98.8   256450298   195677273   135640406
 7 2017-06-01     98.8     98.8     98.8   195677273   135640406    59935547
 8 2017-09-01     98.8     98.8     98.8   135640406    59935547    75541458
 9 2017-12-01     98.8     98.8     98.8    59935547    75541458   158378320
10 2018-03-01     98.8     98.8     98.9    75541458   158378320    43910678
# ℹ 15 more rows
# ℹ 7 more variables: ADHK_lag2 &lt;dbl&gt;, ADHK_lag1 &lt;dbl&gt;, ADHK_lag0 &lt;dbl&gt;,
#   ADHK_lead1 &lt;dbl&gt;, ADHK_lead2 &lt;dbl&gt;, ADHK_lead3 &lt;dbl&gt;, ADHK_lead4 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>test_df <span class="ot">&lt;-</span> mimo_df2 <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(date_lg0<span class="sc">&gt;=</span><span class="st">"2022-01-01"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>test_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 14
  date_lg0   ihk_lag2 ihk_lag1 ihk_lag0 ekspor_lag2 ekspor_lag1 ekspor_lag0
  &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
1 2022-03-01     105.     106.     108.   101489132    58472552   212100511
2 2022-06-01     106.     108.     111.    58472552   212100511   323431909
3 2022-09-01     108.     111.     112.   212100511   323431909   212074483
4 2022-12-01     111.     112.     113.   323431909   212074483   232322051
# ℹ 7 more variables: ADHK_lag2 &lt;dbl&gt;, ADHK_lag1 &lt;dbl&gt;, ADHK_lag0 &lt;dbl&gt;,
#   ADHK_lead1 &lt;dbl&gt;, ADHK_lead2 &lt;dbl&gt;, ADHK_lead3 &lt;dbl&gt;, ADHK_lead4 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>input_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">select</span>(train_df,<span class="fu">contains</span>(<span class="st">"lag"</span>)))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>input_cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ihk_lag2"    "ihk_lag1"    "ihk_lag0"    "ekspor_lag2" "ekspor_lag1"
[6] "ekspor_lag0" "ADHK_lag2"   "ADHK_lag1"   "ADHK_lag0"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>output_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">select</span>(train_df,<span class="fu">contains</span>(<span class="st">"lead"</span>)))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>output_cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ADHK_lead1" "ADHK_lead2" "ADHK_lead3" "ADHK_lead4"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">train_lstm_mimo</span>(<span class="at">data =</span> train_df,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">input_cols =</span> input_cols,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">output_cols =</span> output_cols,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">date_col =</span> <span class="st">"date_lg0"</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">val_split =</span> <span class="fl">0.2</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">epochs =</span> <span class="dv">100</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">batch_size =</span> <span class="dv">32</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">optimizer =</span> <span class="st">"adam"</span>,</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hidden_size =</span> <span class="dv">100</span>,</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">num_layers =</span> <span class="dv">1</span>,</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">activation =</span> <span class="st">"linear"</span>)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>mod2<span class="sc">$</span>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An `nn_module` containing 44,804 parameters.

── Modules ─────────────────────────────────────────────────────────────────────
• lstm: &lt;nn_lstm&gt; #44,400 parameters
• fc: &lt;nn_linear&gt; #404 parameters
• act: &lt;nn_identity&gt; #0 parameters</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_lstm_history</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AI-untuk-Nowcasting_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>res2 <span class="ot">&lt;-</span> <span class="fu">forecast_lstm</span>(<span class="at">history =</span> mod2,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">output_var =</span> <span class="st">"ADHK_lag0"</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">train_data =</span> train_df,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">test_data =</span> test_df)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>res2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">"forecast"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  date       type      value
  &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt;
1 2022-03-01 forecast 24882.
2 2022-06-01 forecast 27567.
3 2022-09-01 forecast 22362.
4 2022-12-01 forecast 22730.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>yardstick<span class="sc">::</span><span class="fu">rmse_vec</span>(<span class="at">truth =</span> <span class="fu">filter</span>(res2,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"actual"</span>,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                                   date<span class="sc">&gt;=</span><span class="st">"2022-01-01"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">estimate =</span> <span class="fu">filter</span>(res2,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"forecast"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>                                   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2632.635</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MAPE</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>yardstick<span class="sc">::</span><span class="fu">mape_vec</span>(<span class="at">truth =</span> <span class="fu">filter</span>(res2,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"actual"</span>,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                                   date<span class="sc">&gt;=</span><span class="st">"2022-01-01"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value),</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">estimate =</span> <span class="fu">filter</span>(res2,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"forecast"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>                                   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.947727</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_time_series</span>(<span class="at">.data=</span>res2,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.date_var =</span> date,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.value =</span> value,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.interactive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.title =</span>  <span class="st">"Forecast Plot"</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.color_var =</span> type,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.legend_show =</span> <span class="cn">FALSE</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.smooth =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-e935852506a524087623" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-e935852506a524087623">{"x":{"data":[{"x":["2015-09-01","2015-12-01","2016-03-01","2016-06-01","2016-12-01","2017-03-01","2017-06-01","2017-09-01","2017-12-01","2018-03-01","2018-06-01","2018-09-01","2018-12-01","2019-03-01","2019-06-01","2019-09-01","2019-12-01","2020-03-01","2020-06-01","2020-09-01","2020-12-01","2021-03-01","2021-06-01","2021-09-01","2021-12-01","2022-03-01","2022-06-01","2022-09-01","2022-12-01"],"y":[24374.334027248889,22283.070611894102,22642.587611175819,23601.375454395711,23121.844485519661,21900.939674178651,23227.806896269041,26216.93911944022,23262.523663377611,21902.121658271029,22931.43210456644,22560.134202729128,22955.44111643307,22278.275247701258,23403.919555955112,23996.11239211075,24194.131451733159,22945.513703232031,23108.487888401782,23765.241863749859,23469.630183956458,22674.932258046829,24211.197038823699,24340.7128142291,24211.013853100911,24428.428568851228,25661.558370508581,26069.732704650251,25914.354565935479],"text":["date: 2015-09-01<br />.value: 24374.33<br />.color_mod: actual<br />.color_mod: actual","date: 2015-12-01<br />.value: 22283.07<br />.color_mod: actual<br />.color_mod: actual","date: 2016-03-01<br />.value: 22642.59<br />.color_mod: actual<br />.color_mod: actual","date: 2016-06-01<br />.value: 23601.38<br />.color_mod: actual<br />.color_mod: actual","date: 2016-12-01<br />.value: 23121.84<br />.color_mod: actual<br />.color_mod: actual","date: 2017-03-01<br />.value: 21900.94<br />.color_mod: actual<br />.color_mod: actual","date: 2017-06-01<br />.value: 23227.81<br />.color_mod: actual<br />.color_mod: actual","date: 2017-09-01<br />.value: 26216.94<br />.color_mod: actual<br />.color_mod: actual","date: 2017-12-01<br />.value: 23262.52<br />.color_mod: actual<br />.color_mod: actual","date: 2018-03-01<br />.value: 21902.12<br />.color_mod: actual<br />.color_mod: actual","date: 2018-06-01<br />.value: 22931.43<br />.color_mod: actual<br />.color_mod: actual","date: 2018-09-01<br />.value: 22560.13<br />.color_mod: actual<br />.color_mod: actual","date: 2018-12-01<br />.value: 22955.44<br />.color_mod: actual<br />.color_mod: actual","date: 2019-03-01<br />.value: 22278.28<br />.color_mod: actual<br />.color_mod: actual","date: 2019-06-01<br />.value: 23403.92<br />.color_mod: actual<br />.color_mod: actual","date: 2019-09-01<br />.value: 23996.11<br />.color_mod: actual<br />.color_mod: actual","date: 2019-12-01<br />.value: 24194.13<br />.color_mod: actual<br />.color_mod: actual","date: 2020-03-01<br />.value: 22945.51<br />.color_mod: actual<br />.color_mod: actual","date: 2020-06-01<br />.value: 23108.49<br />.color_mod: actual<br />.color_mod: actual","date: 2020-09-01<br />.value: 23765.24<br />.color_mod: actual<br />.color_mod: actual","date: 2020-12-01<br />.value: 23469.63<br />.color_mod: actual<br />.color_mod: actual","date: 2021-03-01<br />.value: 22674.93<br />.color_mod: actual<br />.color_mod: actual","date: 2021-06-01<br />.value: 24211.20<br />.color_mod: actual<br />.color_mod: actual","date: 2021-09-01<br />.value: 24340.71<br />.color_mod: actual<br />.color_mod: actual","date: 2021-12-01<br />.value: 24211.01<br />.color_mod: actual<br />.color_mod: actual","date: 2022-03-01<br />.value: 24428.43<br />.color_mod: actual<br />.color_mod: actual","date: 2022-06-01<br />.value: 25661.56<br />.color_mod: actual<br />.color_mod: actual","date: 2022-09-01<br />.value: 26069.73<br />.color_mod: actual<br />.color_mod: actual","date: 2022-12-01<br />.value: 25914.35<br />.color_mod: actual<br />.color_mod: actual"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(44,62,80,1)","dash":"solid"},"hoveron":"points","name":"actual","legendgroup":"actual","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":["2022-03-01","2022-06-01","2022-09-01","2022-12-01"],"y":[24881.749314725181,27566.768357825684,22362.376340928939,22729.505972137682],"text":["date: 2022-03-01<br />.value: 24881.75<br />.color_mod: forecast<br />.color_mod: forecast","date: 2022-06-01<br />.value: 27566.77<br />.color_mod: forecast<br />.color_mod: forecast","date: 2022-09-01<br />.value: 22362.38<br />.color_mod: forecast<br />.color_mod: forecast","date: 2022-12-01<br />.value: 22729.51<br />.color_mod: forecast<br />.color_mod: forecast"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(227,26,28,1)","dash":"solid"},"hoveron":"points","name":"forecast","legendgroup":"forecast","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":25.570776255707766,"l":40.182648401826491},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724},"title":{"text":"Forecast Plot","font":{"color":"rgba(44,62,80,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"date","autorange":true,"range":["2015-04-21","2023-04-12"],"tickmode":"auto","ticktext":["2016","2018","2020","2022"],"tickvals":[16801,17532,18262,18993],"categoryorder":"array","categoryarray":["2016","2018","2020","2022"],"nticks":null,"ticks":"outside","tickcolor":"rgba(204,204,204,1)","ticklen":3.6529680365296811,"tickwidth":0.22139200221392005,"showticklabels":true,"tickfont":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.22139200221392005,"zeroline":false,"anchor":"y","title":{"text":"","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":true,"range":[21617.648239996299,27850.059792008036],"tickmode":"auto","ticktext":["22000","24000","26000"],"tickvals":[22000,24000,26000],"categoryorder":"array","categoryarray":["22000","24000","26000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(204,204,204,1)","ticklen":3.6529680365296811,"tickwidth":0.22139200221392005,"showticklabels":true,"tickfont":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.22139200221392005,"zeroline":false,"anchor":"x","title":{"text":"","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(44,62,80,1)","width":0.33208800332088001,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"6d5878739ab":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"6d5878739ab","visdat":{"6d5878739ab":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="rnn" class="level2">
<h2 class="anchored" data-anchor-id="rnn">RNN</h2>
<section id="fungsi-pembantu-1" class="level3">
<h3 class="anchored" data-anchor-id="fungsi-pembantu-1">Fungsi Pembantu</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>train_rnn_mimo <span class="ot">&lt;-</span> <span class="cf">function</span>(data,</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>                            date_col,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                            input_cols,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                            output_cols,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">val_split    =</span> <span class="fl">0.2</span>,</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">epochs       =</span> <span class="dv">50</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">batch_size   =</span> <span class="dv">32</span>,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">lr           =</span> <span class="fl">1e-3</span>,</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">optimizer    =</span> <span class="fu">c</span>(<span class="st">"adam"</span>,<span class="st">"sgd"</span>),</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">hidden_size  =</span> <span class="dv">50</span>,</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">num_layers   =</span> <span class="dv">1</span>,</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">activation   =</span> <span class="fu">c</span>(<span class="st">"tanh"</span>,<span class="st">"relu"</span>,<span class="st">"linear"</span>),</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">dropout      =</span> <span class="fl">0.0</span>,</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>                            <span class="at">weight_decay =</span> <span class="fl">0.0</span>) {</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  optimizer <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(optimizer)</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  activation <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(activation)</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  date_col   <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">ensym</span>(date_col)</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) Order by time index</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">!!</span>date_col)</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) Split data</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>  n     <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>  n_val <span class="ot">&lt;-</span> <span class="fu">floor</span>(val_split <span class="sc">*</span> n)</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>  train_df <span class="ot">&lt;-</span> data[<span class="dv">1</span><span class="sc">:</span>(n <span class="sc">-</span> n_val), ]</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>  val_df   <span class="ot">&lt;-</span> data[(n <span class="sc">-</span> n_val <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n, ]</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) Compute robust scaler on train_df</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>  input_median  <span class="ot">&lt;-</span> <span class="fu">sapply</span>(input_cols, <span class="cf">function</span>(col) <span class="fu">median</span>(train_df[[col]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>  input_iqr     <span class="ot">&lt;-</span> <span class="fu">sapply</span>(input_cols, <span class="cf">function</span>(col) <span class="fu">IQR</span>(train_df[[col]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>  output_median <span class="ot">&lt;-</span> <span class="fu">sapply</span>(output_cols,<span class="cf">function</span>(col) <span class="fu">median</span>(train_df[[col]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>  output_iqr    <span class="ot">&lt;-</span> <span class="fu">sapply</span>(output_cols,<span class="cf">function</span>(col) <span class="fu">IQR</span>(train_df[[col]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>  scaler <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">input_median  =</span> input_median,</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">input_iqr     =</span> input_iqr,</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_median =</span> output_median,</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_iqr    =</span> output_iqr</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4) Apply scaling to train and validation sets</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> input_cols) {</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>    train_df[[col]] <span class="ot">&lt;-</span> (train_df[[col]] <span class="sc">-</span> scaler<span class="sc">$</span>input_median[col]) <span class="sc">/</span> scaler<span class="sc">$</span>input_iqr[col]</span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>    val_df[[col]]   <span class="ot">&lt;-</span> (val_df[[col]]   <span class="sc">-</span> scaler<span class="sc">$</span>input_median[col]) <span class="sc">/</span> scaler<span class="sc">$</span>input_iqr[col]</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> output_cols) {</span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a>    train_df[[col]] <span class="ot">&lt;-</span> (train_df[[col]] <span class="sc">-</span> scaler<span class="sc">$</span>output_median[col]) <span class="sc">/</span> scaler<span class="sc">$</span>output_iqr[col]</span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a>    val_df[[col]]   <span class="ot">&lt;-</span> (val_df[[col]]   <span class="sc">-</span> scaler<span class="sc">$</span>output_median[col]) <span class="sc">/</span> scaler<span class="sc">$</span>output_iqr[col]</span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 5) Define the RNN module</span></span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a>  RNNModel <span class="ot">&lt;-</span> <span class="fu">nn_module</span>(</span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RNNModel"</span>,</span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">initialize =</span> <span class="cf">function</span>(input_size,</span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a>                        hidden_size,</span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a>                        num_layers,</span>
<span id="cb65-56"><a href="#cb65-56" aria-hidden="true" tabindex="-1"></a>                        dropout,</span>
<span id="cb65-57"><a href="#cb65-57" aria-hidden="true" tabindex="-1"></a>                        output_size,</span>
<span id="cb65-58"><a href="#cb65-58" aria-hidden="true" tabindex="-1"></a>                        activation,</span>
<span id="cb65-59"><a href="#cb65-59" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nonlinearity =</span> <span class="fu">c</span>(<span class="st">"tanh"</span>,<span class="st">"relu"</span>)) {</span>
<span id="cb65-60"><a href="#cb65-60" aria-hidden="true" tabindex="-1"></a>    nonlinearity <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(nonlinearity)</span>
<span id="cb65-61"><a href="#cb65-61" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>rnn <span class="ot">&lt;-</span> <span class="fu">nn_rnn</span>(</span>
<span id="cb65-62"><a href="#cb65-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">input_size   =</span> input_size,</span>
<span id="cb65-63"><a href="#cb65-63" aria-hidden="true" tabindex="-1"></a>      <span class="at">hidden_size  =</span> hidden_size,</span>
<span id="cb65-64"><a href="#cb65-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">num_layers   =</span> num_layers,</span>
<span id="cb65-65"><a href="#cb65-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">nonlinearity =</span> nonlinearity,</span>
<span id="cb65-66"><a href="#cb65-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">batch_first  =</span> <span class="cn">TRUE</span>,</span>
<span id="cb65-67"><a href="#cb65-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">dropout      =</span> dropout</span>
<span id="cb65-68"><a href="#cb65-68" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-69"><a href="#cb65-69" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>fc  <span class="ot">&lt;-</span> <span class="fu">nn_linear</span>(hidden_size, output_size)</span>
<span id="cb65-70"><a href="#cb65-70" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>act <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb65-71"><a href="#cb65-71" aria-hidden="true" tabindex="-1"></a>      activation,</span>
<span id="cb65-72"><a href="#cb65-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">tanh   =</span> <span class="fu">nn_tanh</span>(),</span>
<span id="cb65-73"><a href="#cb65-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">relu   =</span> <span class="fu">nn_relu</span>(),</span>
<span id="cb65-74"><a href="#cb65-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">linear =</span> <span class="fu">nn_identity</span>()</span>
<span id="cb65-75"><a href="#cb65-75" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-76"><a href="#cb65-76" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb65-77"><a href="#cb65-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">forward =</span> <span class="cf">function</span>(x) {</span>
<span id="cb65-78"><a href="#cb65-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># x: [batch, seq_len, input_size]</span></span>
<span id="cb65-79"><a href="#cb65-79" aria-hidden="true" tabindex="-1"></a>    out   <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">rnn</span>(x)</span>
<span id="cb65-80"><a href="#cb65-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># out[[1]] is the output at every time step: shape [batch, seq_len, hidden]</span></span>
<span id="cb65-81"><a href="#cb65-81" aria-hidden="true" tabindex="-1"></a>    last  <span class="ot">&lt;-</span> out[[<span class="dv">1</span>]][ , <span class="fu">dim</span>(out[[<span class="dv">1</span>]])[<span class="dv">2</span>], ]</span>
<span id="cb65-82"><a href="#cb65-82" aria-hidden="true" tabindex="-1"></a>    h_act <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">act</span>(last)</span>
<span id="cb65-83"><a href="#cb65-83" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span><span class="fu">fc</span>(h_act)</span>
<span id="cb65-84"><a href="#cb65-84" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-85"><a href="#cb65-85" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-86"><a href="#cb65-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-87"><a href="#cb65-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-88"><a href="#cb65-88" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 6) Prepare torch datasets</span></span>
<span id="cb65-89"><a href="#cb65-89" aria-hidden="true" tabindex="-1"></a>  make_ds <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb65-90"><a href="#cb65-90" aria-hidden="true" tabindex="-1"></a>    x_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(df[, input_cols])</span>
<span id="cb65-91"><a href="#cb65-91" aria-hidden="true" tabindex="-1"></a>    y_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(df[, output_cols])</span>
<span id="cb65-92"><a href="#cb65-92" aria-hidden="true" tabindex="-1"></a>    X <span class="ot">&lt;-</span> <span class="fu">torch_tensor</span>(x_mat, <span class="at">dtype =</span> <span class="fu">torch_float</span>())<span class="sc">$</span><span class="fu">view</span>(<span class="fu">c</span>(<span class="fu">nrow</span>(x_mat), <span class="sc">-</span><span class="dv">1</span>, <span class="fu">length</span>(input_cols)))</span>
<span id="cb65-93"><a href="#cb65-93" aria-hidden="true" tabindex="-1"></a>    Y <span class="ot">&lt;-</span> <span class="fu">torch_tensor</span>(y_mat, <span class="at">dtype =</span> <span class="fu">torch_float</span>())</span>
<span id="cb65-94"><a href="#cb65-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y)</span>
<span id="cb65-95"><a href="#cb65-95" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-96"><a href="#cb65-96" aria-hidden="true" tabindex="-1"></a>  train_ds <span class="ot">&lt;-</span> <span class="fu">make_ds</span>(train_df)</span>
<span id="cb65-97"><a href="#cb65-97" aria-hidden="true" tabindex="-1"></a>  val_ds   <span class="ot">&lt;-</span> <span class="fu">make_ds</span>(val_df)</span>
<span id="cb65-98"><a href="#cb65-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-99"><a href="#cb65-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 7) Instantiate model and optimizer</span></span>
<span id="cb65-100"><a href="#cb65-100" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">RNNModel</span>(</span>
<span id="cb65-101"><a href="#cb65-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">input_size   =</span> <span class="fu">length</span>(input_cols),</span>
<span id="cb65-102"><a href="#cb65-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">hidden_size  =</span> hidden_size,</span>
<span id="cb65-103"><a href="#cb65-103" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_layers   =</span> num_layers,</span>
<span id="cb65-104"><a href="#cb65-104" aria-hidden="true" tabindex="-1"></a>  <span class="at">dropout      =</span> dropout,</span>
<span id="cb65-105"><a href="#cb65-105" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_size  =</span> <span class="fu">length</span>(output_cols),</span>
<span id="cb65-106"><a href="#cb65-106" aria-hidden="true" tabindex="-1"></a>  <span class="at">activation   =</span> activation,</span>
<span id="cb65-107"><a href="#cb65-107" aria-hidden="true" tabindex="-1"></a>  <span class="at">nonlinearity =</span> <span class="st">"relu"</span>)</span>
<span id="cb65-108"><a href="#cb65-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-109"><a href="#cb65-109" aria-hidden="true" tabindex="-1"></a>  optim <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb65-110"><a href="#cb65-110" aria-hidden="true" tabindex="-1"></a>    optimizer,</span>
<span id="cb65-111"><a href="#cb65-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">adam =</span> <span class="fu">optim_adam</span>(model<span class="sc">$</span>parameters, <span class="at">lr =</span> lr, <span class="at">weight_decay =</span> weight_decay),</span>
<span id="cb65-112"><a href="#cb65-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">sgd  =</span> <span class="fu">optim_sgd</span>(model<span class="sc">$</span>parameters, <span class="at">lr =</span> lr, <span class="at">weight_decay =</span> weight_decay)</span>
<span id="cb65-113"><a href="#cb65-113" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-114"><a href="#cb65-114" aria-hidden="true" tabindex="-1"></a>  criterion <span class="ot">&lt;-</span> <span class="fu">nn_mse_loss</span>()</span>
<span id="cb65-115"><a href="#cb65-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-116"><a href="#cb65-116" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 8) Training loop</span></span>
<span id="cb65-117"><a href="#cb65-117" aria-hidden="true" tabindex="-1"></a>  train_loss <span class="ot">&lt;-</span> <span class="fu">numeric</span>(epochs)</span>
<span id="cb65-118"><a href="#cb65-118" aria-hidden="true" tabindex="-1"></a>  val_loss   <span class="ot">&lt;-</span> <span class="fu">numeric</span>(epochs)</span>
<span id="cb65-119"><a href="#cb65-119" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (e <span class="cf">in</span> <span class="fu">seq_len</span>(epochs)) {</span>
<span id="cb65-120"><a href="#cb65-120" aria-hidden="true" tabindex="-1"></a>    model<span class="sc">$</span><span class="fu">train</span>()</span>
<span id="cb65-121"><a href="#cb65-121" aria-hidden="true" tabindex="-1"></a>    optim<span class="sc">$</span><span class="fu">zero_grad</span>()</span>
<span id="cb65-122"><a href="#cb65-122" aria-hidden="true" tabindex="-1"></a>    preds_train <span class="ot">&lt;-</span> <span class="fu">model</span>(train_ds<span class="sc">$</span>x)</span>
<span id="cb65-123"><a href="#cb65-123" aria-hidden="true" tabindex="-1"></a>    loss_train  <span class="ot">&lt;-</span> <span class="fu">criterion</span>(preds_train, train_ds<span class="sc">$</span>y)</span>
<span id="cb65-124"><a href="#cb65-124" aria-hidden="true" tabindex="-1"></a>    loss_train<span class="sc">$</span><span class="fu">backward</span>()</span>
<span id="cb65-125"><a href="#cb65-125" aria-hidden="true" tabindex="-1"></a>    optim<span class="sc">$</span><span class="fu">step</span>()</span>
<span id="cb65-126"><a href="#cb65-126" aria-hidden="true" tabindex="-1"></a>    train_loss[e] <span class="ot">&lt;-</span> loss_train<span class="sc">$</span><span class="fu">item</span>()</span>
<span id="cb65-127"><a href="#cb65-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-128"><a href="#cb65-128" aria-hidden="true" tabindex="-1"></a>    model<span class="sc">$</span><span class="fu">eval</span>()</span>
<span id="cb65-129"><a href="#cb65-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with_no_grad</span>({</span>
<span id="cb65-130"><a href="#cb65-130" aria-hidden="true" tabindex="-1"></a>      preds_val    <span class="ot">&lt;-</span> <span class="fu">model</span>(val_ds<span class="sc">$</span>x)</span>
<span id="cb65-131"><a href="#cb65-131" aria-hidden="true" tabindex="-1"></a>      val_loss[e]  <span class="ot">&lt;-</span> <span class="fu">criterion</span>(preds_val, val_ds<span class="sc">$</span>y)<span class="sc">$</span><span class="fu">item</span>()</span>
<span id="cb65-132"><a href="#cb65-132" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb65-133"><a href="#cb65-133" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-134"><a href="#cb65-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-135"><a href="#cb65-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb65-136"><a href="#cb65-136" aria-hidden="true" tabindex="-1"></a>    <span class="at">model       =</span> model,</span>
<span id="cb65-137"><a href="#cb65-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">train_loss  =</span> train_loss,</span>
<span id="cb65-138"><a href="#cb65-138" aria-hidden="true" tabindex="-1"></a>    <span class="at">val_loss    =</span> val_loss,</span>
<span id="cb65-139"><a href="#cb65-139" aria-hidden="true" tabindex="-1"></a>    <span class="at">scaler      =</span> scaler,</span>
<span id="cb65-140"><a href="#cb65-140" aria-hidden="true" tabindex="-1"></a>    <span class="at">input_cols  =</span> input_cols,</span>
<span id="cb65-141"><a href="#cb65-141" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_cols =</span> output_cols,</span>
<span id="cb65-142"><a href="#cb65-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_col    =</span> rlang<span class="sc">::</span><span class="fu">as_string</span>(date_col)</span>
<span id="cb65-143"><a href="#cb65-143" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-144"><a href="#cb65-144" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>plot_rnn_history <span class="ot">&lt;-</span> <span class="cf">function</span>(history) {</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">epoch =</span> <span class="fu">seq_along</span>(history<span class="sc">$</span>train_loss),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">training =</span> <span class="fu">sqrt</span>(history<span class="sc">$</span>train_loss),</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">validation =</span> <span class="fu">sqrt</span>(history<span class="sc">$</span>val_loss)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span>epoch, <span class="at">names_to =</span> <span class="st">"data"</span>, <span class="at">values_to =</span> <span class="st">"loss"</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(epoch, loss, <span class="at">color =</span> data)) <span class="sc">+</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Training vs Validation Loss"</span>,</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x     =</span> <span class="st">"Epoch"</span>,</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">y     =</span> <span class="st">"RMSE"</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>predict_rnn <span class="ot">&lt;-</span> <span class="cf">function</span>(history, new_data) {</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  model       <span class="ot">&lt;-</span> history<span class="sc">$</span>model</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  scaler      <span class="ot">&lt;-</span> history<span class="sc">$</span>scaler</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  input_cols  <span class="ot">&lt;-</span> history<span class="sc">$</span>input_cols</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  output_cols <span class="ot">&lt;-</span> history<span class="sc">$</span>output_cols</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  date_col    <span class="ot">&lt;-</span> history<span class="sc">$</span>date_col</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  dates <span class="ot">&lt;-</span> new_data[[date_col]]</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  x_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(new_data[, input_cols])</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  X     <span class="ot">&lt;-</span> <span class="fu">torch_tensor</span>(x_mat, <span class="at">dtype =</span> <span class="fu">torch_float</span>())<span class="sc">$</span><span class="fu">view</span>(<span class="fu">c</span>(<span class="fu">nrow</span>(x_mat), <span class="sc">-</span><span class="dv">1</span>, <span class="fu">ncol</span>(x_mat)))</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  model<span class="sc">$</span><span class="fu">eval</span>()</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with_no_grad</span>({ pred_scaled <span class="ot">&lt;-</span> <span class="fu">model</span>(X) })</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  pred_scaled_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pred_scaled)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inverse robust scaling</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>  pred_orig <span class="ot">&lt;-</span> <span class="fu">sweep</span>(pred_scaled_mat, <span class="dv">2</span>, scaler<span class="sc">$</span>output_iqr, <span class="st">`</span><span class="at">*</span><span class="st">`</span>)</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  pred_orig <span class="ot">&lt;-</span> <span class="fu">sweep</span>(pred_orig, <span class="dv">2</span>, scaler<span class="sc">$</span>output_median, <span class="st">`</span><span class="at">+</span><span class="st">`</span>)</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Build output tibble</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>  pred_df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(pred_orig)</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(pred_df) <span class="ot">&lt;-</span> output_cols</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">date =</span> dates) <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(pred_df)</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>forecast_rnn <span class="ot">&lt;-</span> <span class="cf">function</span>(history,output_var,train_data,<span class="at">test_data=</span><span class="cn">NULL</span>){</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  forecast <span class="ot">&lt;-</span> <span class="fu">predict_rnn</span>(<span class="at">history =</span> history,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">new_data =</span> train_data <span class="sc">%&gt;%</span> <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">where</span>(is.Date),</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">values_to =</span> <span class="st">"forecast"</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>                                         )</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>new_dates <span class="ot">&lt;-</span>  train_data <span class="sc">%&gt;%</span> </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(<span class="fu">where</span>(is.Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">pull</span>()</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="fu">nrow</span>(forecast))) {</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>  new_dates[i<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">ymd</span>(new_dates[i]) <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">3</span>)</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">date=</span>new_dates[<span class="sc">-</span><span class="dv">1</span>],</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">forecast =</span> forecast <span class="sc">%&gt;%</span> <span class="fu">pull</span>(forecast)</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span> </span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">where</span>(is.Date),<span class="fu">all_of</span>(output_var)) <span class="sc">%&gt;%</span> </span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">where</span>(is.Date),<span class="at">names_to =</span> <span class="st">"type"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type=</span><span class="st">"actual"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.Date),<span class="at">.fn =</span> <span class="cf">function</span>(x) <span class="st">"date"</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="sc">%&gt;%</span> </span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">where</span>(is.Date),<span class="at">names_to =</span> <span class="st">"type"</span>)</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="at">.cols=</span><span class="fu">where</span>(is.Date),<span class="at">.fn =</span>  <span class="cf">function</span>(x) <span class="st">"date"</span> )</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(test_data)){</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> test_data <span class="sc">%&gt;%</span> </span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(<span class="fu">where</span>(is.Date),<span class="fu">all_of</span>(output_var)) <span class="sc">%&gt;%</span> </span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>              <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">where</span>(is.Date),<span class="at">names_to =</span> <span class="st">"type"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">type=</span><span class="st">"actual"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.Date),<span class="at">.fn =</span> <span class="cf">function</span>(x) <span class="st">"date"</span> )</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(result,test_data)</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(result)</span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="satu-variabel-1" class="level3">
<h3 class="anchored" data-anchor-id="satu-variabel-1">Satu Variabel</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>mimo_df1 <span class="ot">&lt;-</span> <span class="fu">prepare_mimo_data</span>(<span class="at">data =</span> <span class="fu">na.omit</span>(df),</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">date_col =</span> date,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">input_vars =</span> <span class="fu">c</span>(<span class="st">"ADHK"</span>),</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">output_vars =</span> <span class="fu">c</span>(<span class="st">"ADHK"</span>),</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lags =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">remove_na =</span> <span class="cn">TRUE</span>,</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">horizon =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>mimo_df1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 29 × 8
   date_lg0   ADHK_lag2 ADHK_lag1 ADHK_lag0 ADHK_lead1 ADHK_lead2 ADHK_lead3
   &lt;date&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1 2015-09-01    20908.    21772.    24374.     22283.     22643.     23601.
 2 2015-12-01    21772.    24374.    22283.     22643.     23601.     23122.
 3 2016-03-01    24374.    22283.    22643.     23601.     23122.     21901.
 4 2016-06-01    22283.    22643.    23601.     23122.     21901.     23228.
 5 2016-12-01    22643.    23601.    23122.     21901.     23228.     26217.
 6 2017-03-01    23601.    23122.    21901.     23228.     26217.     23263.
 7 2017-06-01    23122.    21901.    23228.     26217.     23263.     21902.
 8 2017-09-01    21901.    23228.    26217.     23263.     21902.     22931.
 9 2017-12-01    23228.    26217.    23263.     21902.     22931.     22560.
10 2018-03-01    26217.    23263.    21902.     22931.     22560.     22955.
# ℹ 19 more rows
# ℹ 1 more variable: ADHK_lead4 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>train_df <span class="ot">&lt;-</span> mimo_df1 <span class="sc">%&gt;%</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(date_lg0<span class="sc">&lt;</span><span class="st">"2022-01-01"</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>train_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 8
   date_lg0   ADHK_lag2 ADHK_lag1 ADHK_lag0 ADHK_lead1 ADHK_lead2 ADHK_lead3
   &lt;date&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1 2015-09-01    20908.    21772.    24374.     22283.     22643.     23601.
 2 2015-12-01    21772.    24374.    22283.     22643.     23601.     23122.
 3 2016-03-01    24374.    22283.    22643.     23601.     23122.     21901.
 4 2016-06-01    22283.    22643.    23601.     23122.     21901.     23228.
 5 2016-12-01    22643.    23601.    23122.     21901.     23228.     26217.
 6 2017-03-01    23601.    23122.    21901.     23228.     26217.     23263.
 7 2017-06-01    23122.    21901.    23228.     26217.     23263.     21902.
 8 2017-09-01    21901.    23228.    26217.     23263.     21902.     22931.
 9 2017-12-01    23228.    26217.    23263.     21902.     22931.     22560.
10 2018-03-01    26217.    23263.    21902.     22931.     22560.     22955.
# ℹ 15 more rows
# ℹ 1 more variable: ADHK_lead4 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>test_df <span class="ot">&lt;-</span> mimo_df1 <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(date_lg0<span class="sc">&gt;=</span><span class="st">"2022-01-01"</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>test_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 8
  date_lg0   ADHK_lag2 ADHK_lag1 ADHK_lag0 ADHK_lead1 ADHK_lead2 ADHK_lead3
  &lt;date&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
1 2022-03-01    24341.    24211.    24428.     25662.     26070.     25914.
2 2022-06-01    24211.    24428.    25662.     26070.     25914.     25296.
3 2022-09-01    24428.    25662.    26070.     25914.     25296.     25267.
4 2022-12-01    25662.    26070.    25914.     25296.     25267.     26480.
# ℹ 1 more variable: ADHK_lead4 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>input_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">select</span>(train_df,<span class="fu">contains</span>(<span class="st">"lag"</span>)))</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>input_cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ADHK_lag2" "ADHK_lag1" "ADHK_lag0"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>output_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">select</span>(train_df,<span class="fu">contains</span>(<span class="st">"lead"</span>)))</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>output_cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ADHK_lead1" "ADHK_lead2" "ADHK_lead3" "ADHK_lead4"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">train_rnn_mimo</span>(<span class="at">data =</span> train_df,</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">input_cols =</span> input_cols,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">output_cols =</span> output_cols,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">date_col =</span> <span class="st">"date_lg0"</span>,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">val_split =</span> <span class="fl">0.2</span>,</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">epochs =</span> <span class="dv">75</span>,</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">batch_size =</span> <span class="dv">32</span>,</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">optimizer =</span> <span class="st">"adam"</span>,</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hidden_size =</span> <span class="dv">10</span>,</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">num_layers =</span> <span class="dv">1</span>,</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">activation =</span> <span class="st">"linear"</span>)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>mod3<span class="sc">$</span>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An `nn_module` containing 194 parameters.

── Modules ─────────────────────────────────────────────────────────────────────
• rnn: &lt;nn_rnn&gt; #150 parameters
• fc: &lt;nn_linear&gt; #44 parameters
• act: &lt;nn_identity&gt; #0 parameters</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_rnn_history</span>(mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AI-untuk-Nowcasting_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>res3 <span class="ot">&lt;-</span> <span class="fu">forecast_rnn</span>(<span class="at">history =</span> mod3,</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">output_var =</span> <span class="st">"ADHK_lag0"</span>,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">train_data =</span> train_df,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">test_data =</span> test_df)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>res3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">"forecast"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  date       type         value
  &lt;date&gt;     &lt;chr&gt;        &lt;dbl&gt;
1 2022-03-01 forecast -4241636.
2 2022-06-01 forecast -4583468.
3 2022-09-01 forecast  3227854.
4 2022-12-01 forecast  2838023.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>yardstick<span class="sc">::</span><span class="fu">rmse_vec</span>(<span class="at">truth =</span> <span class="fu">filter</span>(res3,</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"actual"</span>,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                                   date<span class="sc">&gt;=</span><span class="st">"2022-01-01"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value),</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">estimate =</span> <span class="fu">filter</span>(res3,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"forecast"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>                                   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3794824</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MAPE</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>yardstick<span class="sc">::</span><span class="fu">mape_vec</span>(<span class="at">truth =</span> <span class="fu">filter</span>(res3,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"actual"</span>,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>                                   date<span class="sc">&gt;=</span><span class="st">"2022-01-01"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value),</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">estimate =</span> <span class="fu">filter</span>(res3,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"forecast"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>                                   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14639.48</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_time_series</span>(<span class="at">.data=</span>res3,</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.date_var =</span> date,</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.value =</span> value,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.interactive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.title =</span>  <span class="st">"Forecast Plot"</span>,</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.color_var =</span> type,</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.legend_show =</span> <span class="cn">FALSE</span>,</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.smooth =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-5c64a626420afe3d42dc" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-5c64a626420afe3d42dc">{"x":{"data":[{"x":["2015-09-01","2015-12-01","2016-03-01","2016-06-01","2016-12-01","2017-03-01","2017-06-01","2017-09-01","2017-12-01","2018-03-01","2018-06-01","2018-09-01","2018-12-01","2019-03-01","2019-06-01","2019-09-01","2019-12-01","2020-03-01","2020-06-01","2020-09-01","2020-12-01","2021-03-01","2021-06-01","2021-09-01","2021-12-01","2022-03-01","2022-06-01","2022-09-01","2022-12-01"],"y":[24374.334027248889,22283.070611894102,22642.587611175819,23601.375454395711,23121.844485519661,21900.939674178651,23227.806896269041,26216.93911944022,23262.523663377611,21902.121658271029,22931.43210456644,22560.134202729128,22955.44111643307,22278.275247701258,23403.919555955112,23996.11239211075,24194.131451733159,22945.513703232031,23108.487888401782,23765.241863749859,23469.630183956458,22674.932258046829,24211.197038823699,24340.7128142291,24211.013853100911,24428.428568851228,25661.558370508581,26069.732704650251,25914.354565935479],"text":["date: 2015-09-01<br />.value:    24374.33<br />.color_mod: actual<br />.color_mod: actual","date: 2015-12-01<br />.value:    22283.07<br />.color_mod: actual<br />.color_mod: actual","date: 2016-03-01<br />.value:    22642.59<br />.color_mod: actual<br />.color_mod: actual","date: 2016-06-01<br />.value:    23601.38<br />.color_mod: actual<br />.color_mod: actual","date: 2016-12-01<br />.value:    23121.84<br />.color_mod: actual<br />.color_mod: actual","date: 2017-03-01<br />.value:    21900.94<br />.color_mod: actual<br />.color_mod: actual","date: 2017-06-01<br />.value:    23227.81<br />.color_mod: actual<br />.color_mod: actual","date: 2017-09-01<br />.value:    26216.94<br />.color_mod: actual<br />.color_mod: actual","date: 2017-12-01<br />.value:    23262.52<br />.color_mod: actual<br />.color_mod: actual","date: 2018-03-01<br />.value:    21902.12<br />.color_mod: actual<br />.color_mod: actual","date: 2018-06-01<br />.value:    22931.43<br />.color_mod: actual<br />.color_mod: actual","date: 2018-09-01<br />.value:    22560.13<br />.color_mod: actual<br />.color_mod: actual","date: 2018-12-01<br />.value:    22955.44<br />.color_mod: actual<br />.color_mod: actual","date: 2019-03-01<br />.value:    22278.28<br />.color_mod: actual<br />.color_mod: actual","date: 2019-06-01<br />.value:    23403.92<br />.color_mod: actual<br />.color_mod: actual","date: 2019-09-01<br />.value:    23996.11<br />.color_mod: actual<br />.color_mod: actual","date: 2019-12-01<br />.value:    24194.13<br />.color_mod: actual<br />.color_mod: actual","date: 2020-03-01<br />.value:    22945.51<br />.color_mod: actual<br />.color_mod: actual","date: 2020-06-01<br />.value:    23108.49<br />.color_mod: actual<br />.color_mod: actual","date: 2020-09-01<br />.value:    23765.24<br />.color_mod: actual<br />.color_mod: actual","date: 2020-12-01<br />.value:    23469.63<br />.color_mod: actual<br />.color_mod: actual","date: 2021-03-01<br />.value:    22674.93<br />.color_mod: actual<br />.color_mod: actual","date: 2021-06-01<br />.value:    24211.20<br />.color_mod: actual<br />.color_mod: actual","date: 2021-09-01<br />.value:    24340.71<br />.color_mod: actual<br />.color_mod: actual","date: 2021-12-01<br />.value:    24211.01<br />.color_mod: actual<br />.color_mod: actual","date: 2022-03-01<br />.value:    24428.43<br />.color_mod: actual<br />.color_mod: actual","date: 2022-06-01<br />.value:    25661.56<br />.color_mod: actual<br />.color_mod: actual","date: 2022-09-01<br />.value:    26069.73<br />.color_mod: actual<br />.color_mod: actual","date: 2022-12-01<br />.value:    25914.35<br />.color_mod: actual<br />.color_mod: actual"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(44,62,80,1)","dash":"solid"},"hoveron":"points","name":"actual","legendgroup":"actual","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":["2022-03-01","2022-06-01","2022-09-01","2022-12-01"],"y":[-4241636.4918956133,-4583467.5224663923,3227854.1267104978,2838023.3999899467],"text":["date: 2022-03-01<br />.value: -4241636.49<br />.color_mod: forecast<br />.color_mod: forecast","date: 2022-06-01<br />.value: -4583467.52<br />.color_mod: forecast<br />.color_mod: forecast","date: 2022-09-01<br />.value:  3227854.13<br />.color_mod: forecast<br />.color_mod: forecast","date: 2022-12-01<br />.value:  2838023.40<br />.color_mod: forecast<br />.color_mod: forecast"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(227,26,28,1)","dash":"solid"},"hoveron":"points","name":"forecast","legendgroup":"forecast","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":25.570776255707766,"l":46.027397260273986},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724},"title":{"text":"Forecast Plot","font":{"color":"rgba(44,62,80,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"date","autorange":true,"range":["2015-04-21","2023-04-12"],"tickmode":"auto","ticktext":["2016","2018","2020","2022"],"tickvals":[16801,17532,18262,18993],"categoryorder":"array","categoryarray":["2016","2018","2020","2022"],"nticks":null,"ticks":"outside","tickcolor":"rgba(204,204,204,1)","ticklen":3.6529680365296811,"tickwidth":0.22139200221392005,"showticklabels":true,"tickfont":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.22139200221392005,"zeroline":false,"anchor":"y","title":{"text":"","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":true,"range":[-4974033.6049252367,3618420.2091693422],"tickmode":"auto","ticktext":["-4e+06","-2e+06","0e+00","2e+06"],"tickvals":[-4000000,-2000000,0,2000000],"categoryorder":"array","categoryarray":["-4e+06","-2e+06","0e+00","2e+06"],"nticks":null,"ticks":"outside","tickcolor":"rgba(204,204,204,1)","ticklen":3.6529680365296811,"tickwidth":0.22139200221392005,"showticklabels":true,"tickfont":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.22139200221392005,"zeroline":false,"anchor":"x","title":{"text":"","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(44,62,80,1)","width":0.33208800332088001,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"6d5851003290":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"6d5851003290","visdat":{"6d5851003290":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="multi-variabel-1" class="level3">
<h3 class="anchored" data-anchor-id="multi-variabel-1">Multi Variabel</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#input_vars &lt;- names(select(df,-c(date,ADHK)))</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>input_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ekspor"</span>,<span class="st">"ihk"</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>input_vars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ekspor" "ihk"   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>mimo_df2 <span class="ot">&lt;-</span> <span class="fu">prepare_mimo_data</span>(<span class="at">data =</span> <span class="fu">na.omit</span>(df),</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">date_col =</span> date,</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">input_vars =</span> <span class="fu">c</span>(<span class="st">"ADHK"</span>,input_vars),</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">output_vars =</span> <span class="fu">c</span>(<span class="st">"ADHK"</span>),</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lags =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">remove_na =</span> <span class="cn">TRUE</span>,</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">horizon =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>mimo_df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 29 × 14
   date_lg0   ihk_lag2 ihk_lag1 ihk_lag0 ekspor_lag2 ekspor_lag1 ekspor_lag0
   &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1 2015-09-01     98.9     98.9     98.8    95186751    85868149   146184552
 2 2015-12-01     98.9     98.8     98.8    85868149   146184552   277363045
 3 2016-03-01     98.8     98.8     98.8   146184552   277363045    80837466
 4 2016-06-01     98.8     98.8     98.8   277363045    80837466   256450298
 5 2016-12-01     98.8     98.8     98.8    80837466   256450298   195677273
 6 2017-03-01     98.8     98.8     98.8   256450298   195677273   135640406
 7 2017-06-01     98.8     98.8     98.8   195677273   135640406    59935547
 8 2017-09-01     98.8     98.8     98.8   135640406    59935547    75541458
 9 2017-12-01     98.8     98.8     98.8    59935547    75541458   158378320
10 2018-03-01     98.8     98.8     98.9    75541458   158378320    43910678
# ℹ 19 more rows
# ℹ 7 more variables: ADHK_lag2 &lt;dbl&gt;, ADHK_lag1 &lt;dbl&gt;, ADHK_lag0 &lt;dbl&gt;,
#   ADHK_lead1 &lt;dbl&gt;, ADHK_lead2 &lt;dbl&gt;, ADHK_lead3 &lt;dbl&gt;, ADHK_lead4 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>train_df <span class="ot">&lt;-</span> mimo_df2 <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(date_lg0<span class="sc">&lt;</span><span class="st">"2022-01-01"</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>train_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 14
   date_lg0   ihk_lag2 ihk_lag1 ihk_lag0 ekspor_lag2 ekspor_lag1 ekspor_lag0
   &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1 2015-09-01     98.9     98.9     98.8    95186751    85868149   146184552
 2 2015-12-01     98.9     98.8     98.8    85868149   146184552   277363045
 3 2016-03-01     98.8     98.8     98.8   146184552   277363045    80837466
 4 2016-06-01     98.8     98.8     98.8   277363045    80837466   256450298
 5 2016-12-01     98.8     98.8     98.8    80837466   256450298   195677273
 6 2017-03-01     98.8     98.8     98.8   256450298   195677273   135640406
 7 2017-06-01     98.8     98.8     98.8   195677273   135640406    59935547
 8 2017-09-01     98.8     98.8     98.8   135640406    59935547    75541458
 9 2017-12-01     98.8     98.8     98.8    59935547    75541458   158378320
10 2018-03-01     98.8     98.8     98.9    75541458   158378320    43910678
# ℹ 15 more rows
# ℹ 7 more variables: ADHK_lag2 &lt;dbl&gt;, ADHK_lag1 &lt;dbl&gt;, ADHK_lag0 &lt;dbl&gt;,
#   ADHK_lead1 &lt;dbl&gt;, ADHK_lead2 &lt;dbl&gt;, ADHK_lead3 &lt;dbl&gt;, ADHK_lead4 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>test_df <span class="ot">&lt;-</span> mimo_df2 <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(date_lg0<span class="sc">&gt;=</span><span class="st">"2022-01-01"</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>test_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 14
  date_lg0   ihk_lag2 ihk_lag1 ihk_lag0 ekspor_lag2 ekspor_lag1 ekspor_lag0
  &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
1 2022-03-01     105.     106.     108.   101489132    58472552   212100511
2 2022-06-01     106.     108.     111.    58472552   212100511   323431909
3 2022-09-01     108.     111.     112.   212100511   323431909   212074483
4 2022-12-01     111.     112.     113.   323431909   212074483   232322051
# ℹ 7 more variables: ADHK_lag2 &lt;dbl&gt;, ADHK_lag1 &lt;dbl&gt;, ADHK_lag0 &lt;dbl&gt;,
#   ADHK_lead1 &lt;dbl&gt;, ADHK_lead2 &lt;dbl&gt;, ADHK_lead3 &lt;dbl&gt;, ADHK_lead4 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>input_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">select</span>(train_df,<span class="fu">contains</span>(<span class="st">"lag"</span>)))</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>input_cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ihk_lag2"    "ihk_lag1"    "ihk_lag0"    "ekspor_lag2" "ekspor_lag1"
[6] "ekspor_lag0" "ADHK_lag2"   "ADHK_lag1"   "ADHK_lag0"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>output_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">select</span>(train_df,<span class="fu">contains</span>(<span class="st">"lead"</span>)))</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>output_cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ADHK_lead1" "ADHK_lead2" "ADHK_lead3" "ADHK_lead4"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">&lt;-</span> <span class="fu">train_rnn_mimo</span>(<span class="at">data =</span> train_df,</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">input_cols =</span> input_cols,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">output_cols =</span> output_cols,</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">date_col =</span> <span class="st">"date_lg0"</span>,</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">val_split =</span> <span class="fl">0.2</span>,</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">epochs =</span> <span class="dv">100</span>,</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">batch_size =</span> <span class="dv">32</span>,</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">optimizer =</span> <span class="st">"adam"</span>,</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hidden_size =</span> <span class="dv">100</span>,</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">num_layers =</span> <span class="dv">1</span>,</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">activation =</span> <span class="st">"linear"</span>)</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>mod4<span class="sc">$</span>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An `nn_module` containing 11,504 parameters.

── Modules ─────────────────────────────────────────────────────────────────────
• rnn: &lt;nn_rnn&gt; #11,100 parameters
• fc: &lt;nn_linear&gt; #404 parameters
• act: &lt;nn_identity&gt; #0 parameters</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_rnn_history</span>(mod4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AI-untuk-Nowcasting_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>res4 <span class="ot">&lt;-</span> <span class="fu">forecast_lstm</span>(<span class="at">history =</span> mod4,</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">output_var =</span> <span class="st">"ADHK_lag0"</span>,</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">train_data =</span> train_df,</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">test_data =</span> test_df)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>res4 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">"forecast"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  date       type            value
  &lt;date&gt;     &lt;chr&gt;           &lt;dbl&gt;
1 2022-03-01 forecast 21822356370.
2 2022-06-01 forecast 44357986296.
3 2022-09-01 forecast 11052495367.
4 2022-12-01 forecast 13501860922.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>yardstick<span class="sc">::</span><span class="fu">rmse_vec</span>(<span class="at">truth =</span> <span class="fu">filter</span>(res4,</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"actual"</span>,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>                                   date<span class="sc">&gt;=</span><span class="st">"2022-01-01"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value),</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">estimate =</span> <span class="fu">filter</span>(res4,</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"forecast"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>                                   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 26212112988</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MAPE</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>yardstick<span class="sc">::</span><span class="fu">mape_vec</span>(<span class="at">truth =</span> <span class="fu">filter</span>(res4,</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"actual"</span>,</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>                                   date<span class="sc">&gt;=</span><span class="st">"2022-01-01"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value),</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">estimate =</span> <span class="fu">filter</span>(res4,</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>                                   type<span class="sc">==</span><span class="st">"forecast"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value)</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>                                   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 89171721</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_time_series</span>(<span class="at">.data=</span>res4,</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.date_var =</span> date,</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.value =</span> value,</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.interactive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.title =</span>  <span class="st">"Forecast Plot"</span>,</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.color_var =</span> type,</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.legend_show =</span> <span class="cn">FALSE</span>,</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.smooth =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-c596b9e6125918663e74" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-c596b9e6125918663e74">{"x":{"data":[{"x":["2015-09-01","2015-12-01","2016-03-01","2016-06-01","2016-12-01","2017-03-01","2017-06-01","2017-09-01","2017-12-01","2018-03-01","2018-06-01","2018-09-01","2018-12-01","2019-03-01","2019-06-01","2019-09-01","2019-12-01","2020-03-01","2020-06-01","2020-09-01","2020-12-01","2021-03-01","2021-06-01","2021-09-01","2021-12-01","2022-03-01","2022-06-01","2022-09-01","2022-12-01"],"y":[24374.334027248889,22283.070611894102,22642.587611175819,23601.375454395711,23121.844485519661,21900.939674178651,23227.806896269041,26216.93911944022,23262.523663377611,21902.121658271029,22931.43210456644,22560.134202729128,22955.44111643307,22278.275247701258,23403.919555955112,23996.11239211075,24194.131451733159,22945.513703232031,23108.487888401782,23765.241863749859,23469.630183956458,22674.932258046829,24211.197038823699,24340.7128142291,24211.013853100911,24428.428568851228,25661.558370508581,26069.732704650251,25914.354565935479],"text":["date: 2015-09-01<br />.value: 2.437433e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2015-12-01<br />.value: 2.228307e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2016-03-01<br />.value: 2.264259e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2016-06-01<br />.value: 2.360138e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2016-12-01<br />.value: 2.312184e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2017-03-01<br />.value: 2.190094e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2017-06-01<br />.value: 2.322781e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2017-09-01<br />.value: 2.621694e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2017-12-01<br />.value: 2.326252e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2018-03-01<br />.value: 2.190212e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2018-06-01<br />.value: 2.293143e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2018-09-01<br />.value: 2.256013e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2018-12-01<br />.value: 2.295544e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2019-03-01<br />.value: 2.227828e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2019-06-01<br />.value: 2.340392e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2019-09-01<br />.value: 2.399611e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2019-12-01<br />.value: 2.419413e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2020-03-01<br />.value: 2.294551e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2020-06-01<br />.value: 2.310849e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2020-09-01<br />.value: 2.376524e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2020-12-01<br />.value: 2.346963e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2021-03-01<br />.value: 2.267493e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2021-06-01<br />.value: 2.421120e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2021-09-01<br />.value: 2.434071e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2021-12-01<br />.value: 2.421101e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2022-03-01<br />.value: 2.442843e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2022-06-01<br />.value: 2.566156e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2022-09-01<br />.value: 2.606973e+04<br />.color_mod: actual<br />.color_mod: actual","date: 2022-12-01<br />.value: 2.591435e+04<br />.color_mod: actual<br />.color_mod: actual"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(44,62,80,1)","dash":"solid"},"hoveron":"points","name":"actual","legendgroup":"actual","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":["2022-03-01","2022-06-01","2022-09-01","2022-12-01"],"y":[21822356370.09119,44357986295.669952,11052495366.94828,13501860921.935768],"text":["date: 2022-03-01<br />.value: 2.182236e+10<br />.color_mod: forecast<br />.color_mod: forecast","date: 2022-06-01<br />.value: 4.435799e+10<br />.color_mod: forecast<br />.color_mod: forecast","date: 2022-09-01<br />.value: 1.105250e+10<br />.color_mod: forecast<br />.color_mod: forecast","date: 2022-12-01<br />.value: 1.350186e+10<br />.color_mod: forecast<br />.color_mod: forecast"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(227,26,28,1)","dash":"solid"},"hoveron":"points","name":"forecast","legendgroup":"forecast","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":25.570776255707766,"l":40.182648401826491},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724},"title":{"text":"Forecast Plot","font":{"color":"rgba(44,62,80,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"date","autorange":true,"range":["2015-04-21","2023-04-12"],"tickmode":"auto","ticktext":["2016","2018","2020","2022"],"tickvals":[16801,17532,18262,18993],"categoryorder":"array","categoryarray":["2016","2018","2020","2022"],"nticks":null,"ticks":"outside","tickcolor":"rgba(204,204,204,1)","ticklen":3.6529680365296811,"tickwidth":0.22139200221392005,"showticklabels":true,"tickfont":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.22139200221392005,"zeroline":false,"anchor":"y","title":{"text":"","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":true,"range":[-2217876318.7968397,46575884515.406464],"tickmode":"auto","ticktext":["0e+00","1e+10","2e+10","3e+10","4e+10"],"tickvals":[0,10000000000,20000000000,30000000000,40000000000],"categoryorder":"array","categoryarray":["0e+00","1e+10","2e+10","3e+10","4e+10"],"nticks":null,"ticks":"outside","tickcolor":"rgba(204,204,204,1)","ticklen":3.6529680365296811,"tickwidth":0.22139200221392005,"showticklabels":true,"tickfont":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.22139200221392005,"zeroline":false,"anchor":"x","title":{"text":"","font":{"color":"rgba(44,62,80,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(44,62,80,1)","width":0.33208800332088001,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(44,62,80,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"6d5875633cc8":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"6d5875633cc8","visdat":{"6d5875633cc8":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>